import{A as e,V as t,C as i,N as s,T as o,S as a,M as n,a as r,b as l,c as h,d as c,B as u,E as m,m as d,o as _,e as p,f as g,H as f,D as A,g as w,h as v,i as T,Q as k,j as y,k as E,R as b,l as N,L as S,I as M,n as R,p as I,U as O,q as P,r as C,s as L,t as B,u as x,v as U,w as D,x as F,y as H,z as V,F as G,G as $,J as W,K as z,O as Y,P as j,W as J,X as K,Y as q,Z as X,_ as Z,$ as Q,a0 as ee,a1 as te,a2 as ie,a3 as se,a4 as oe,a5 as ae,a6 as ne,a7 as re,a8 as le,a9 as he,aa as ce,ab as ue,ac as me,ad as de,ae as _e,af as pe,ag as ge,ah as fe,ai as Ae,aj as we,ak as ve,al as Te,am as ke,an as ye,ao as Ee,ap as be,aq as Ne,ar as Se,as as Me,at as Re,au as Ie,av as Oe,aw as Pe,ax as Ce,ay as Le,az as Be,aA as xe,aB as Ue,aC as De,aD as Fe,aE as He,aF as Ve,aG as Ge,aH as $e,aI as We,aJ as ze,aK as Ye,aL as je,aM as Je,aN as Ke,aO as qe}from"./vendor.9f6a7dbd.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(i){const s=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((i,a)=>{const n=new URL(e,s);if(self[t].moduleMap[n])return i(self[t].moduleMap[n]);const r=new Blob([`import * as m from '${n}';`,`${t}.moduleMap['${n}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){a(new Error(`Failed to import: ${e}`)),o(l)},onload(){i(self[t].moduleMap[n]),o(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/Web3DStudio/assets/");const Xe=class{constructor(s){this._scene=s;let o=new e("camera",Math.PI/2,1.186,10,t.Zero(),this._scene);this._camera=o,this._scene.clearColor=i.FromInts(72,128,215,255),this.startLoadingAnimation()}get scene(){return this._scene.activeCamera=this._camera,this._scene}async startLoadingAnimation(){let e=new s("cubeLoaderMat",this._scene,{emitComments:!1}),t=new o("guiNode");t.position.y=-1,this.setLoadingLabel(t),await a.AppendAsync("model/cubeLoading.glb"),await e.loadAsync("nodeMaterial/loading.json"),e.build(!1);let i=[this._scene.getMeshByName("spinnerLeft"),this._scene.getMeshByName("spinnerCenter"),this._scene.getMeshByName("spinnerRight")],r=[];i.forEach(((t,i)=>{t&&t instanceof n&&(t.material=e,null!==t.morphTargetManager&&r.push(t.morphTargetManager.getTarget(0)))}));let l=this._scene.getAnimationGroupByName("loadingSpin");this.animateInfluence(r[0],Xe.morphAnimations.leftMorph,l,!1),this.animateInfluence(r[1],Xe.morphAnimations.centerMorph,l,!1),this.animateInfluence(r[2],Xe.morphAnimations.rightMorph,l,!0)}setLoadingLabel(e){let t=r.CreateFullscreenUI("loadingGUI");this.progressText=new l,this.progressText.text="加载中... \n 0/100 ",this.progressText.fontSize=25,this.progressText.color="white",t.addControl(this.progressText),this.progressText.linkWithMesh(e)}updateProgress(e,t){this.progressText&&(this.progressText.text=t?`加载中... \n ${t} \n ${e}/100`:`加载中... \n ${e}/100`)}animateInfluence(e,t,i,s){let o=new h("influenceAnimation","influence",60,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CYCLE);o.setKeys(t),i.addTargetedAnimation(o,e),s&&i.play(!0)}};let Ze=Xe;Ze.morphAnimations={leftMorph:[{frame:0,value:0},{frame:20,value:0},{frame:35,value:1},{frame:115,value:1},{frame:130,value:0},{frame:400,value:0}],centerMorph:[{frame:0,value:0},{frame:135,value:0},{frame:150,value:1},{frame:220,value:1},{frame:235,value:0},{frame:400,value:0}],rightMorph:[{frame:0,value:0},{frame:250,value:0},{frame:265,value:1},{frame:335,value:1},{frame:350,value:0},{frame:400,value:0}]};var Qe,et;(et=Qe||(Qe={}))[et.init=0]="init",et[et.uping=1]="uping",et[et.done=2]="done",et[et.downing=3]="downing";const tt=class{constructor(e,i,s,o){this._position=new t,this._state=0,this._fence=new n("fence",o),this._fence.isPickable=!1,this._scene=o;let a=[];a[0]=.5*e,a[1]=0,a[2]=.5*-i,a[3]=.5*e,a[4]=0,a[5]=.5*i,a[6]=.5*-e,a[7]=0,a[8]=.5*i,a[9]=.5*-e,a[10]=0,a[11]=.5*-i,a[12]=.5*e,a[13]=s,a[14]=.5*-i,a[15]=.5*e,a[16]=s,a[17]=.5*i,a[18]=.5*-e,a[19]=s,a[20]=.5*i,a[21]=.5*-e,a[22]=s,a[23]=.5*-i;let r=[],l=[];r.push(0,1,4),r.push(5,4,1),r.push(6,5,2),r.push(1,2,5),r.push(3,6,2),r.push(7,6,3),r.push(7,0,4),r.push(7,3,0);let h=new c;c.ComputeNormals(a,r,l),h.indices=r,h.positions=a,h.normals=l,h.uvs=[0,0,1/3,0,1/3*2,0,1,0,0,1,1/3,1,1/3*2,1,1,1],h.applyToMesh(this._fence),this.loadMat()}get fence(){return this._fence}async loadMat(){let e=new s("fence_Mat",this._scene);e.backFaceCulling=!1,await e.loadAsync("nodeMaterial/fence.json"),e.build(!1),this._fence.material=e}up(){0==this._state||3==this._state?(this._downAnim&&this._downAnim.stop(),this.createUpAnimation(),this._upAnim=this._scene.beginAnimation(this._fence,0,tt.frameRate,!1,void 0,(()=>{this._state=2})),this._state=1):1==this._state||this._state}down(){2==this._state||1==this._state?(this._upAnim&&this._upAnim.stop(),this.createDownAnimation(),this._downAnim=this._scene.beginAnimation(this._fence,0,tt.frameRate,!1,void 0,(()=>{this._state=0})),this._state=3):0==this._state||this._state}set position(e){this._position.copyFrom(e),this._fence.position.copyFrom(this._position),this._fence.animations=[]}createUpAnimation(){let e=new h("up","position.y",tt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT);const t=[];t.push({frame:0,value:this._fence.position.y}),t.push({frame:60,value:this._position.y+1.2}),e.setKeys(t);let i=new u;i.setEasingMode(m.EASINGMODE_EASEOUT),e.setEasingFunction(i),this._fence.animations.push(e)}createDownAnimation(){let e=new h("down","position.y",tt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT);const t=[];t.push({frame:0,value:this._fence.position.y}),t.push({frame:60,value:this._position.y});let i=new u;i.setEasingMode(m.EASINGMODE_EASEOUT),e.setEasingFunction(i),e.setKeys(t),this._fence.animations.push(e)}};let it=tt;var st,ot;it.frameRate=60,(ot=st||(st={})).A="building_1",ot.B="building_2",ot.C="building_3",ot.D="building_4",ot.E="building_5";const at={colleges:[{uuid:1,name:"北京三维学院",modelUrl:"model/building/building_1.glb",position:st.A,scale:[1,1,1],rotation:[0,Math.PI,0]},{uuid:2,name:"成都精通学院",modelUrl:"model/building/building_2.glb",position:st.B,scale:[1,1,1],rotation:[0,Math.PI,0]}],mapModelURL:"model/map.glb"},nt=[{uuid:1,description:"Java介于编译型语言和解释型语言之间。编译型语言如C、C++，代码是直接编译成机器码执行，但是不同的平台（x86、ARM等）CPU的指令集不同，因此，需要编译出每一种平台的对应机器码。解释型语言如Python、Ruby没有这个问题",logoUrl:"img/studioLogo/JAVALogo.png",name:"JAVA高并发工作室"},{uuid:2,description:"Android是基于Linux系统的开源操作系统，是由Andy Rubin于2003年在美国加州创建",logoUrl:"img/studioLogo/AndroidLogo.png",name:"Android旋律工作室"}],rt=[{uuid:1,name:"北京三维学院",position:"北京市朝阳区",description:"那么， 就我个人来说，北京三维学院对我的意义，不能不说非常重大。 \n        总结的来说， 生活中，若北京三维学院出现了，我们就不得不考虑它出现了的事实。 \n        北京三维学院的发生，到底需要如何做到，不北京三维学院的发生，又会如何产生。 \n        爱尔兰曾经说过，越是无能的人，越喜欢挑剔别人的错儿。这句话把我们带到了一个新的维度去思考这个问题: \n        既然如此， 我们都知道，只要有意义，那么就必须慎重考虑。 对我个人而言，\n        北京三维学院不仅仅是一个重大的事件，还可能会改变我的人生。",studios:nt,imgUrl:"img/buildingSnapshot/BeiJing.png"},{uuid:2,name:"成都精通学院",position:"四川省成都市",description:"就我个人来说，成都精通学院对我的意义，不能不说非常重大。 \n        卡耐基在不经意间这样说过，我们若已接受最坏的，就再没有什么损失。\n        这句话语虽然很短, 但令我浮想联翩. 对我个人而言，\n        成都精通学院不仅仅是一个重大的事件，还可能会改变我的人生。 \n        本人也是经过了深思熟虑，在每个日日夜夜思考这个问题。 \n        对我个人而言，成都精通学院不仅仅是一个重大的事件，还可能会改变我的人生。 \n",studios:nt,imgUrl:"img/buildingSnapshot/ChengDu.png"}];const lt=new class{constructor(){this.isShowing=!1,this.college=null,d(this,{isShowing:_,college:_,setShowing:p})}setShowing(e){this.isShowing=e,e||(this.college=null)}fetchCollegeDescriptionByName(e){null==this.college&&async function(e){return await setTimeout((()=>{}),5e3),rt.find((t=>t.name===e))}(e).then((e=>{e&&(this.college=e)}))}};class ht{constructor(e,t,s){this._collegeNode=[],this._buildingMeshUniqueID=[],this._collegeToFence=new Map,this._iState=t,this._collegeMap=s,this._scene=e,this._scene.clearColor=new i(.375,162/256,226/256,1),this._clickSound=new g("clickSound","sound/collegeBuildingClick.mp3",this._scene,(()=>{}),{volume:.3})}async load(){this.setCamera(),await this.loadMap(),this.setLight()}setLight(){new f("HemisphericLight",new t(0,1,0),this._scene).intensity=.5;let e=new A("directionalLight",new t(1,-1.5,.5),this._scene);e.position=new t(-20,10,-10),e.intensity=1.4;let i=new w(1024,e);i.usePercentageCloserFiltering=!0,i.addShadowCaster(this._scene.getMeshByName("tree"));let s=this._scene.getMeshByName("ground");this._buildingMeshUniqueID.forEach((e=>{let t=this._scene.getMeshByUniqueID(e);t&&i.addShadowCaster(t)})),s.receiveShadows=!0}setClick(e,t){const i=lt,s=new v(this._scene);e.getChildMeshes(!0)[0].getChildMeshes(!0).forEach((o=>{let a=this._collegeToFence.get(e.name);o.actionManager=s,o.actionManager.registerAction(new T(v.OnPointerOverTrigger,(t=>{a.up(),this._clickSound.play(),i.fetchCollegeDescriptionByName(e.name),i.setShowing(!0)}))),o.actionManager.registerAction(new T(v.OnPointerOutTrigger,(e=>{a.down(),i.setShowing(!1)}))),o.actionManager.registerAction(new T(v.OnPickDownTrigger,(s=>{console.log(`进入学院 ${e.name}`),i.setShowing(!1),this._iState.goToCollege(t.uuid)})))}))}setCamera(){let i=new e("chooseCollegeCamera",0,Math.PI/3.5,40,t.Zero(),this._scene);i.attachControl(),i.useAutoRotationBehavior=!0,i.autoRotationBehavior.idleRotationSpeed=.12,i.autoRotationBehavior.idleRotationWaitTime=1e3,i.lowerRadiusLimit=40,i.upperRadiusLimit=40,i.lowerBetaLimit=Math.PI/3.5,i.upperBetaLimit=Math.PI/3.5}async loadMap(){(await a.ImportMeshAsync("",this._collegeMap.mapModelURL,void 0,this._scene)).meshes.forEach((e=>{e.isPickable=!1}));let e=new Map;if(this._scene.transformNodes.forEach((t=>{for(let i=0;i<this._collegeMap.colleges.length;i++){const s=this._collegeMap.colleges[i];s.position==t.name&&e.set(s,t.position)}})),e.size!=this._collegeMap.colleges.length)return console.log("地图数据错误"),void console.log(e);let i=r.CreateFullscreenUI("builiding_UI",!0,this._scene);for(let s=0;s<this._collegeMap.colleges.length;s++){const n=this._collegeMap.colleges[s];let r=new o(n.name,this._scene);this._collegeNode.push(r);let h=(await a.ImportMeshAsync("",n.modelUrl,void 0,this._scene)).meshes[0];this._buildingMeshUniqueID.push(h.uniqueId),h.scaling=new t(n.scale[0],n.scale[1],n.scale[2]),h.rotationQuaternion=k.FromEulerAngles(0,0,0),h.parent=r;let c=e.get(n);r.position.set(-c.x,c.y,c.z);let u=new l;u.text=n.name,u.fontSize=20,u.color="white",i.addControl(u),u.linkWithMesh(h),u.linkOffsetY=-100;let m=h.getChildMeshes()[0].getBoundingInfo().boundingBox,d=m.maximum.subtract(m.minimum),_=new it(d.x+.5,d.z+.5,.6,this._scene);_.position=new t(r.position.x,r.position.y-1,r.position.z),this._collegeToFence.set(r.name,_),this.setClick(r,n)}}}ht.map={name:"map",modelUrl:"model/map.glb"};const ct=class{constructor(e,t,i,s,a){this._locNode=[],this.hasLoadedTexture=!1,this._scene=e,this._floor=i,this._web3DStudio=t,this._floorTransformNode=new o(`floor-${i.floorNumber}`,this._scene),this._startName=`floor-${i.floorNumber}-meshes`;s.clone(this._startName).parent=this._floorTransformNode,this.setUpStudioBox(),this.setUpUnnecessary(),this.setUpLoc(),this._originYPos=(this._floor.floorNumber-1)*ct.HEIGHT,this._maxYPos=a-(this._floor.floorNumber-1)*ct.HEIGHT,this._floorTransformNode.position.y=this._originYPos,this.enableDepthPrePass(),this.translucent(),this.invisibleStudioBox(),this.hideUnnecessary()}setUpStudioBox(){const e=this._floorTransformNode.getChildMeshes();let t=[],i=0;e.forEach((e=>{if(e.name.startsWith(`${this._startName}.${ct.STUDIO_BOX_NAME}`)){const s=new y(`${e.name}Mat`,this._scene);s.diffuseColor=E.FromHexString(ct.StudioBoxColor[i++]),s.specularColor=E.Black(),e.material=s,e.visibility=1,t.push(e)}})),t.sort(((e,t)=>e.name<t.name?-1:1)),this._studioBox=t}invisibleStudioBox(){for(let e=0;e<this._studioBox.length;e++)this._studioBox[e].isVisible=!1}visibleStudioBox(){for(let e=0;e<this._floor.studios.length;e++)this._studioBox[e].isVisible=!0}showStudioName(e){for(let i=0;i<this._floor.studios.length;i++){const s=this._studioBox[i],o=this._floor.studios[i];let a=new b;a.width=.2,a.height="40px",a.cornerRadius=20,a.color="#67daff",a.thickness=4,a.background="#3498DB",e.addControl(a),a.linkWithMesh(s),a.linkOffsetY=-150;let n=new l;n.text=o.name,n.color="white",a.addControl(n);let r=new N;r.width="40px",r.height="40px",r.color="#67daff",r.thickness=4,r.background="#3498DB",e.addControl(r),r.linkWithMesh(s);var t=new S;t.lineWidth=4,t.color="#67daff",t.y2=20,t.linkOffsetY=-20,e.addControl(t),t.linkWithMesh(s),t.connectedControl=a}}enableDepthPrePass(){this._floorTransformNode.getChildMeshes().forEach((e=>{const t=e.material;null!=t&&(t.needDepthPrePass=!0)}))}translucent(){this._floorTransformNode.getChildMeshes().forEach((e=>{e.isVisible=!0,e instanceof M||(e.visibility=1)}))}floorInvisible(){let e=this._floorTransformNode.getChildMeshes();e=e.filter((e=>e instanceof n)),e.forEach((e=>{this._scene.beginDirectAnimation(e,this.createInvisibleAnim(e),0,ct.frameRate,!1)}))}floorVisible(e){let t=this._floorTransformNode.getChildMeshes();t=t.filter((e=>e instanceof n)),t.forEach(((i,s)=>{s!=t.length-1?this._scene.beginDirectAnimation(i,this.createVisibleAnim(i),0,ct.frameRate,!1):this._scene.beginDirectAnimation(i,this.createVisibleAnim(i),0,ct.frameRate,!1,void 0,(()=>{e&&e()}))}))}createInvisibleAnim(e){const t=new h(`invisibleAnim-${this._floor.floorNumber}`,"visibility",ct.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:e.visibility}),i.push({frame:ct.frameRate,value:1}),t.setKeys(i),[t]}createVisibleAnim(e){const t=new h(`visibleAnim-${this._floor.floorNumber}`,"visibility",ct.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:e.visibility}),i.push({frame:ct.frameRate,value:1}),t.setKeys(i),[t]}pushToOrigin(e,t){const i=e/1e3;this._scene.beginDirectAnimation(this._floorTransformNode,this.createPushAnim(i),0,ct.frameRate*i+ct.pushAnimationTime,!1,void 0,(()=>{t&&t()}))}popToMaxHeight(e,t){const i=e/1e3;this._scene.beginDirectAnimation(this._floorTransformNode,this.createPopAnim(i),0,ct.frameRate*i+ct.popAnimationTime,!1,void 0,(()=>{t&&t()}))}createPushAnim(e){const t=new h(`pushAnim-${this._floor.floorNumber}`,"position.y",ct.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:this._floorTransformNode.position.y}),i.push({frame:ct.frameRate*e,value:this._floorTransformNode.position.y}),i.push({frame:ct.frameRate*e+ct.pushAnimationTime,value:this._originYPos}),t.setKeys(i),[t]}createPopAnim(e){const t=new h(`popAnim-${this._floor.floorNumber}`,"position.y",ct.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:this._floorTransformNode.position.y}),i.push({frame:ct.frameRate*e,value:this._floorTransformNode.position.y}),i.push({frame:ct.frameRate*e+ct.pushAnimationTime,value:this._maxYPos}),t.setKeys(i),[t]}setHighLight(e){this._studioBox.forEach((t=>{t instanceof n&&(t.actionManager=new v(this._scene),t.actionManager.registerAction(new T(v.OnPointerOverTrigger,(()=>{e.addMesh(t,E.White())}))),t.actionManager.registerAction(new T(v.OnPointerOutTrigger,(()=>{e.removeMesh(t)}))))}))}openDoor(e,t){const i=`${this._startName}.${ct.LEFT_DOOR_NAME}${e}`,s=`${this._startName}.${ct.RIGHT_DOOR_NAME}${e}`,o=this._floorTransformNode.getChildMeshes();let a=null,r=null;o.forEach((e=>{(e instanceof n||e instanceof M)&&(e.name==i?a=e:e.name==s&&(r=e))})),console.log(a,r),null!=a&&null!=r&&(1==e||2==e?(this._scene.beginDirectAnimation(a,this.createDoorAnim(a,-Math.PI/2),0,ct.frameRate,!1,1,t),this._scene.beginDirectAnimation(r,this.createDoorAnim(r,Math.PI/2),0,ct.frameRate,!1)):3==e||4==e?(this._scene.beginDirectAnimation(a,this.createDoorAnim(a,Math.PI/2),0,ct.frameRate,!1,1,t),this._scene.beginDirectAnimation(r,this.createDoorAnim(r,-Math.PI/2),0,ct.frameRate,!1)):(this._scene.beginDirectAnimation(a,this.createDoorAnim(a,Math.PI),0,ct.frameRate,!1,1,t),this._scene.beginDirectAnimation(r,this.createDoorAnim(r,0),0,ct.frameRate,!1)))}createDoorAnim(e,t){if(null!=e.rotationQuaternion){const i=new h(`DoorAnim-${this._floor.floorNumber}`,"rotationQuaternion",ct.frameRate,h.ANIMATIONTYPE_QUATERNION,h.ANIMATIONLOOPMODE_CONSTANT),s=[];return s.push({frame:0,value:e.rotationQuaternion}),s.push({frame:ct.frameRate,value:k.FromEulerAngles(0,t,0)}),i.setKeys(s),[i]}return[]}hide(){this._floorTransformNode.getChildMeshes().forEach((e=>{e.isVisible=!1}))}hideUnnecessary(){this._unnecessaryList.forEach((e=>{e.isVisible=!1}))}setUpUnnecessary(){let e=[];this._floorTransformNode.getChildMeshes().forEach((t=>{t.name.startsWith(`${this._startName}.SM_`)&&(t.isVisible=!1,e.push(t))})),this._unnecessaryList=e}showUnnecessary(){this._unnecessaryList.forEach((e=>{e.isVisible=!0}))}loadTexture(){if(this.hasLoadedTexture)return;const e=this._floorTransformNode.getChildMeshes();let t=[],i=[];e.forEach((e=>{e instanceof n&&(e.name.startsWith(`${this._startName}.${ct.POST_NAME}`)?t.push(e):e.name.startsWith(`${this._startName}.${ct.STUDIO_NAME}`)&&i.push(e))})),t.sort(((e,t)=>e.name<t.name?-1:1)),i.sort(((e,t)=>e.name<t.name?-1:1));for(let s=0;s<this._floor.studios.length;s++){const e=this._floor.studios[s],o=new y(`${this._startName}.PostMat${s}`,this._scene),a=new R(e.posterURL,this._scene);a.uAng=Math.PI,o.diffuseTexture=a,t[s].material=o;const n=new y(`${this._startName}.LogoMat${s}`,this._scene),r=new R(e.logoURL,this._scene);r.uAng=Math.PI,n.diffuseTexture=r,i[s].material=n}this.hasLoadedTexture=!0}setUpLoc(){this._floorTransformNode.getChildTransformNodes().forEach((e=>{e.name.startsWith(`${this._startName}.Loc_`)&&this._locNode.push(e)}))}get locTransformNode(){return this._locNode}};let ut=ct;ut.HEIGHT=8,ut.STUDIO_BOX_NAME="studio_box_",ut.StudioBoxColor=["#FFDBAC","#F6DEE4","#C1DDF9","#EAE2D6","#D1F8E9","#C6EB93"],ut.frameRate=60,ut.pushAnimationTime=ct.frameRate/4,ut.popAnimationTime=ct.frameRate,ut.LEFT_DOOR_NAME="studio_door_left_",ut.RIGHT_DOOR_NAME="studio_door_right_",ut.POST_NAME="post_",ut.STUDIO_NAME="studio_name_";const mt=new class{constructor(){this.uiShowing=!1,this.everyFloorUiShowing=!1,this.visitUiShowing=!1,this.visitStudioUiShowing=!1,this.collegeManager=null,this.floorTotalNumber=0,this.collegeFloors=null,I(this,{collegeManager:!1,goToFloor:!1,onMouseEnterVisitButton:!1,onMouseLeaveVisitButton:!1,goToVisit:!1})}setFloorUiShowing(e){this.uiShowing=e}setVisitUiShowing(e){this.visitUiShowing=e}setVisitStudioUiShowing(e){this.visitStudioUiShowing=e}setEveryFloorUiShowing(e){this.everyFloorUiShowing=e}setFloorTotalNumber(e){this.floorTotalNumber=e}goToFloor(e){this.collegeManager&&this.collegeManager.goToFloor(e)}goToStudio(){this.collegeManager&&this.collegeManager.goToStudio()}onMouseEnterVisitButton(){this.collegeManager&&this.collegeManager.cameraSmoothOut()}onMouseLeaveVisitButton(){this.collegeManager&&this.collegeManager.cameraSmoothIn()}goToVisit(){this.collegeManager&&this.collegeManager.visitFloor()}setFloorInfo(e){this.collegeFloors=e}},dt=class extends o{constructor(e,i,s){super("playerRoot",i),this._h=0,this._v=0,this._moveDirection=new t(0,0,0),this._gravity=new t(0,0,0),this._grounded=!0,this._dashTime=0,this._dashStart=!1,this._canJump=!0,this._canDash=!0,this._inputController=s,this._setUpPlayerCamera(),this.mesh=e.collisionBox,this._animation={idle:e.animationGroups[0],leftTurn:e.animationGroups[1],rightTurn:e.animationGroups[2],run:e.animationGroups[3],walk:e.animationGroups[4]},this._setUpAnimation(),this._scene.registerBeforeRender((()=>{this._playerUpdate()}))}_setUpPlayerCamera(){this._cameraRoot=new o("playerCameraRoot",this._scene),this._cameraRoot.position=new t(0,0,0);let e=new o("backRotate",this._scene);e.parent=this._cameraRoot,e.rotation=new t(0,Math.PI,0),this._yTilt=new o("yTilt"),this._yTilt.parent=e,this._yTilt.rotation.set(-Math.PI/4,0,0),this.camera=new O("playerCamera",new t(0,0,12),this._scene),this.camera.lockedTarget=this._cameraRoot.position,this.camera.parent=this._yTilt,this._scene.activeCamera=this.camera}_updateCamera(){let e=this.mesh.position.y+ft.CollisionBoxHeight/2;this._cameraRoot.position=t.Lerp(this._cameraRoot.position,new t(this.mesh.position.x,e,this.mesh.position.z),.2)}_updateFromInputController(){this._moveDirection=t.Zero(),this._h=this._inputController.horizontal,this._v=this._inputController.vertical;let e=this._cameraRoot.forward,i=this._cameraRoot.right,s=e.scaleInPlace(this._v),o=i.scaleInPlace(this._h),a=s.addInPlace(o).normalize();this._inputController.dashing&&this._canDash&&(this._dashStart=!0,this._canDash=!1);let n=1;if(this._dashStart&&(this._dashTime>dt.PLAYER_DASH_TIME?(this._dashTime=0,this._canDash=!0,this._dashStart=!1):n=dt.PLAYER_DASH_FACTOR,this._dashTime++),this._moveDirection=new t(a.x,0,a.z),this._moveDirection=this._moveDirection.scaleInPlace(dt.PLAYER_SPEED*n),0==new t(this._inputController.horizontalAxis,0,this._inputController.verticalAxis).length())return;let r=Math.atan2(this._inputController.horizontalAxis,this._inputController.verticalAxis);r+=this._cameraRoot.rotation.y;let l=k.FromEulerAngles(0,r,0);this.mesh.rotationQuaternion=k.Slerp(this.mesh.rotationQuaternion,l,.075)}_playerUpdate(){this._updateFromInputController(),this._updateCamera(),this._updateGroundDetection(),this._updatePlayerAnimation(),this.mesh.moveWithCollisions(this._moveDirection)}_rayCastToGround(e,i,s){let o=new t(this.mesh.position.x+e,this.mesh.position.y+ft.CollisionBoxHeight/2,this.mesh.position.z+i),a=new P(o,t.Down(),s),n=this._scene.pickWithRay(a,(e=>e.isPickable&&e.isEnabled()));return n&&n.hit&&n.pickedPoint?n.pickedPoint:t.Zero()}_isGrounded(){return!this._rayCastToGround(0,0,ft.CollisionBoxHeight/2+.1).equals(t.Zero())}_updateGroundDetection(){const e=this._scene.getEngine().getDeltaTime()/1e3;let i=this._isGrounded();i||(this._gravity=this._gravity.addInPlace(t.Down().scale(dt.PLAYER_GRAVITY*e)),this._grounded=!1),this._gravity.y<-dt.PLAYER_GRAVITY_MAX&&(this._gravity.y=-dt.PLAYER_GRAVITY_MAX),i&&(this._gravity.y=0,this._grounded=!0,this._canJump=!0),this._inputController.jump&&this._canJump&&(this._gravity.y=dt.PLAYER_GRAVITY_MAX*e*6,this._canJump=!1),this.mesh.moveWithCollisions(this._moveDirection.addInPlace(this._gravity))}_setUpAnimation(){this._scene.stopAllAnimations(),this._animation.run.loopAnimation=!0,this._animation.idle.loopAnimation=!0,this._animation.walk.loopAnimation=!0,this._currentAnimation=this._animation.idle,this._prevAnimation=this._animation.idle}_updatePlayerAnimation(){this._inputController.idle?this._currentAnimation=this._animation.idle:this._inputController.walk?this._currentAnimation=this._animation.walk:this._inputController.dashing?this._currentAnimation=this._animation.run:this._currentAnimation=this._animation.idle,this._currentAnimation!==this._prevAnimation&&(console.log("播放动画"),this._prevAnimation.stop(),this._currentAnimation.play(this._currentAnimation.loopAnimation),this._prevAnimation=this._currentAnimation)}rotateCameraAroundYAxis(e){this._scene.registerBeforeRender((()=>{this._cameraRoot.rotation.y=C.Lerp(this._cameraRoot.rotation.y,e,.01)}))}};let _t=dt;_t.PLAYER_GRAVITY=.1,_t.PLAYER_GRAVITY_MAX=.8,_t.PLAYER_SPEED=.008,_t.PLAYER_DASH_FACTOR=2,_t.PLAYER_DASH_TIME=10;class pt{constructor(e){this.horizontal=0,this.vertical=0,this.horizontalAxis=0,this.verticalAxis=0,this.inputMap={},this.dashing=!1,this.jump=!1,this.idle=!0,this.walk=!1,e.actionManager=new v(e),e.actionManager.registerAction(new T(v.OnKeyDownTrigger,(e=>{if(e.sourceEvent instanceof KeyboardEvent){let t=e.sourceEvent;this.inputMap[t.key]=this.checkKeyDown(t.type)}}))),e.actionManager.registerAction(new T(v.OnKeyUpTrigger,(e=>{if(e.sourceEvent instanceof KeyboardEvent){let t=e.sourceEvent;this.inputMap[t.key]=this.checkKeyDown(t.type)}}))),e.registerBeforeRender((()=>{this._updateFromKeyBoard()}))}_updateFromKeyBoard(){this.inputMap.ArrowUp?(this.vertical=C.Lerp(this.vertical,1,.2),this.verticalAxis=1):this.inputMap.ArrowDown?(this.vertical=C.Lerp(this.vertical,-1,.2),this.verticalAxis=-1):(this.vertical=0,this.verticalAxis=0),this.inputMap.ArrowLeft?(this.horizontal=C.Lerp(this.horizontal,-1,.2),this.horizontalAxis=-1):this.inputMap.ArrowRight?(this.horizontal=C.Lerp(this.horizontal,1,.2),this.horizontalAxis=1):(this.horizontal=0,this.horizontalAxis=0),this.dashing=this.inputMap.Shift,this.jump=this.inputMap[" "],this.inputMap.ArrowUp||this.inputMap.ArrowDown||this.inputMap.ArrowLeft||this.inputMap.ArrowRight||this.dashing||!this.jump?this.idle=!1:this.idle=!0,!(this.inputMap.ArrowUp||this.inputMap.ArrowDown||this.inputMap.ArrowLeft||this.inputMap.ArrowRight)||this.dashing||this.jump?this.walk=!1:this.walk=!0}checkKeyDown(e){return"keydown"==e}}const gt=class{constructor(e,t){this._scene=e,this._playerModelURL=t}async loadPlayer(){let e=await a.ImportMeshAsync("",this._playerModelURL,void 0,this._scene);e.meshes.forEach((e=>{e.isPickable=!1}));let i=L.CreateBox("playerCollisionBox",{width:gt.PlayerCollisionBoxWidth,height:gt.PlayerCollisionBoxHeight,depth:gt.PlayerCollisionBoxDepth});i.bakeTransformIntoVertices(B.Translation(0,gt.PlayerCollisionBoxHeight/2,0)),i.isVisible=!1,i.isPickable=!1,i.checkCollisions=!0,i.ellipsoid=new t(gt.PlayerCollisionBoxWidth/2,gt.PlayerCollisionBoxHeight/2,gt.PlayerCollisionBoxDepth/2),i.ellipsoidOffset=new t(0,gt.PlayerCollisionBoxHeight/2,0),i.rotationQuaternion=new k(0,0,0,0),this._collisionBox=i;let s={collisionBox:i,animationGroups:e.animationGroups},o=e.meshes[0];o.parent=i,o.isPickable=!1;let n=new pt(this._scene),r=new _t(s,this._scene,n);this.player=r}set playerPosition(e){this._collisionBox.position.set(-e.x,e.y,e.z)}get playerPosition(){return this._collisionBox.position}setUpRotateCamera(e){e.forEach((e=>{let t=this._scene.getMeshByName(e.mesh);t&&(t.isVisible=!1,this._scene.registerBeforeRender((()=>{t.intersectsMesh(this._collisionBox,!1,!1)&&this.player.rotateCameraAroundYAxis(e.rotate)})))}))}};let ft=gt;ft.PlayerCollisionBoxWidth=.7,ft.PlayerCollisionBoxHeight=1.8,ft.PlayerCollisionBoxDepth=.5,ft.CollisionBoxWidth=.7,ft.CollisionBoxHeight=1.8,ft.CollisionBoxDepth=.5;class At extends o{constructor(e,t){super("visitPlayerRoot",t),this._setUpPlayerCamera(),this.mesh=e.collisionBox,this._animation={idle:e.animationGroups[0],leftTurn:e.animationGroups[1],rightTurn:e.animationGroups[2],run:e.animationGroups[3],walk:e.animationGroups[4]},this._setUpAnimation(),this._scene.registerBeforeRender((()=>{this._playerUpdate()}))}reset(){this.cameraRotate.rotation=new t(-Math.PI/16,Math.PI,0),this.camera.position.set(0,0,9)}_setUpPlayerCamera(){this._cameraRoot=new o("playerCameraRoot",this._scene),this._cameraRoot.position=new t(0,0,0);let e=new o("cameraRotate",this._scene);e.parent=this._cameraRoot,e.rotation=new t(-Math.PI/16,Math.PI,0),this.cameraRotate=e,this.camera=new O("playerCamera",new t(0,0,9),this._scene),this.camera.lockedTarget=this._cameraRoot.position,this.camera.parent=e}_setUpAnimation(){this._scene.stopAllAnimations(),this._animation.run.loopAnimation=!0,this._animation.idle.loopAnimation=!0,this._animation.walk.loopAnimation=!0,this._currentAnimation=this._animation.idle,this._prevAnimation=this._animation.idle}startWalkAnim(){this._animation.run.stop(),this._animation.idle.stop(),this._animation.walk.start(!0)}startIdleAnim(){this._animation.run.stop(),this._animation.walk.stop(),this._animation.idle.start(!0)}startRunAnim(){this._animation.walk.stop(),this._animation.idle.stop(),this._animation.run.start(!0)}startLeftTurnAnim(){this._animation.walk.stop(),this._animation.idle.stop(),this._animation.run.stop(),this._animation.leftTurn.play(!1)}startRightTurnAnim(){this._animation.walk.stop(),this._animation.idle.stop(),this._animation.run.stop(),this._animation.rightTurn.play(!1)}insertArrow(e,t,i,s,o,a){e.position.set(0,0,0),t.position.set(0,0,0),i.position.set(0,0,0),s.position.set(0,0,0),o.position.set(0,0,0),a.position.set(0,0,0),e.parent=this.mesh,t.parent=this.mesh,i.parent=this.mesh,s.parent=this.mesh,o.parent=this.mesh,a.parent=this.mesh,e.position.set(-.5,.3,1),t.position.set(-.5,.1,-1),i.position.set(-1,.1,1),s.position.set(1,.1,1),o.position.set(-1,.1,1),a.position.set(1,.1,1),e.visibility=.4,t.visibility=.4,i.visibility=.4,s.visibility=.4,o.visibility=.4,a.visibility=.4,this.openDepthPrePass(e),this.openDepthPrePass(t),this.openDepthPrePass(i),this.openDepthPrePass(s),this.openDepthPrePass(o),this.openDepthPrePass(a)}openDepthPrePass(e){e.material&&(e.material.needDepthPrePass=!0)}_playerUpdate(){this._updateCamera()}_updateCamera(){let e=this.mesh.position.y+ft.CollisionBoxHeight;this._cameraRoot.position=t.Lerp(this._cameraRoot.position,new t(this.mesh.position.x,e,this.mesh.position.z),.2)}}const wt=class{constructor(e,t,i){this._visitStudioIndex=0,this._currentLoc=0,this._locNode=[],this._viewDetail=!1,this._scene=e,this._playerModelURL=t,this._arrowModelURL=i}async loadPlayer(){let e=await a.ImportMeshAsync("",this._playerModelURL,void 0,this._scene);e.meshes.forEach((e=>{e.isPickable=!1}));let i=L.CreateBox("playerCollisionBox",{width:ft.PlayerCollisionBoxWidth,height:ft.PlayerCollisionBoxHeight,depth:ft.PlayerCollisionBoxDepth});i.bakeTransformIntoVertices(B.Translation(0,ft.PlayerCollisionBoxHeight/2,0)),i.isVisible=!1,i.isPickable=!1,i.checkCollisions=!0,i.ellipsoid=new t(ft.PlayerCollisionBoxWidth/2,ft.PlayerCollisionBoxHeight/2,ft.PlayerCollisionBoxDepth/2),i.ellipsoidOffset=new t(0,ft.PlayerCollisionBoxHeight/2,0),this._collisionBox=i;let s={collisionBox:i,animationGroups:e.animationGroups},o=e.meshes[0];o.parent=i,o.isPickable=!1;let r=new At(s,this._scene);this.player=r,(await a.ImportMeshAsync("",this._arrowModelURL,void 0,this._scene)).meshes.forEach((e=>{if(e instanceof n)switch(e.name){case wt.UP_ARROW:this._upArrow=e,e.isVisible=!1;break;case wt.DOWN_ARROW:this._downArrow=e,e.isVisible=!1;break;case wt.LEFT_ARROW:this._leftArrow=e,e.isVisible=!1;break;case wt.RIGHT_ARROW:this._rightArrow=e,e.isVisible=!1;break;case wt.LEFT_RETURN_ARROW:this._leftReturnArrow=e,e.isVisible=!1;break;case wt.RIGHT_RETURN_ARROW:this._rightReturnArrow=e,e.isVisible=!1}})),this._upArrow&&this._downArrow&&this._leftArrow&&this._rightArrow&&this._leftReturnArrow&&this._rightReturnArrow&&this.player.insertArrow(this._upArrow,this._downArrow,this._leftArrow,this._rightArrow,this._leftReturnArrow,this._rightReturnArrow),this.setUpArrowAction()}placePlayerAtFloor(e){const t=(e-1)*ut.HEIGHT;this._currentLoc=0,this._collisionBox.rotation.set(0,0,0),this._collisionBox.position.set(0,t,0),this.player.reset()}invisible(){this._collisionBox.getChildMeshes().forEach((e=>{e.isVisible=!1}))}visible(){this._collisionBox.getChildMeshes().forEach((e=>{e.isVisible=!0})),this.hideAllArrow(),this.showArrow()}turnOnCamera(){this._scene.activeCamera=this.player.camera}setUpArrowAction(){this._upArrow&&(this._upArrow.actionManager=new v(this._scene),this._upArrow.actionManager.registerAction(new T(v.OnPickDownTrigger,(()=>{this.goForward()}))),this._upArrow.actionManager.registerAction(new T(v.OnPickUpTrigger,(()=>{})))),this._downArrow&&(this._downArrow.actionManager=new v(this._scene),this._downArrow.actionManager.registerAction(new T(v.OnPickDownTrigger,(()=>{this.goBackward()}))),this._downArrow.actionManager.registerAction(new T(v.OnPickUpTrigger,(()=>{})))),this._leftArrow&&(this._leftArrow.actionManager=new v(this._scene),this._leftArrow.actionManager.registerAction(new T(v.OnPickDownTrigger,(()=>{this.goLeft()}))),this._leftArrow.actionManager.registerAction(new T(v.OnPickUpTrigger,(()=>{})))),this._rightArrow&&(this._rightArrow.actionManager=new v(this._scene),this._rightArrow.actionManager.registerAction(new T(v.OnPickDownTrigger,(()=>{this.goRight()}))),this._rightArrow.actionManager.registerAction(new T(v.OnPickUpTrigger,(()=>{})))),this._leftReturnArrow&&(this._leftReturnArrow.actionManager=new v(this._scene),this._leftReturnArrow.actionManager.registerAction(new T(v.OnPickDownTrigger,(()=>{this.leftReturn()}))),this._leftReturnArrow.actionManager.registerAction(new T(v.OnPickUpTrigger,(()=>{})))),this._rightReturnArrow&&(this._rightReturnArrow.actionManager=new v(this._scene),this._rightReturnArrow.actionManager.registerAction(new T(v.OnPickDownTrigger,(()=>{this.rightReturn()}))),this._rightReturnArrow.actionManager.registerAction(new T(v.OnPickUpTrigger,(()=>{}))))}set locTransformNode(e){this._locNode=e}goForward(){let e="";switch(console.log(this._currentLoc),this._currentLoc){case 0:e="Loc_1",this._currentLoc=1;break;case 1:e="Loc_2",this._currentLoc=2;break;case 2:e="Loc_corner",this._currentLoc=3}if(""==e)return;const t=this._locNode.find((t=>t.name.endsWith(e)));console.log(Math.abs(this._collisionBox.position.z-t.position.z)),Math.abs(this._collisionBox.position.z-t.position.z)>8?this.player.startRunAnim():this.player.startWalkAnim(),this.hideAllArrow(),this._scene.beginDirectAnimation(this._collisionBox,this.createAlongZAnim(t.position.z),0,ut.frameRate,!1,1,(()=>{this.player.startIdleAnim(),this.showArrow()}))}goBackward(){let e="";switch(this._currentLoc){case 0:case 1:break;case 2:e="Loc_1",this._currentLoc=1;break;case 3:e="Loc_2",this._currentLoc=2;break;case 4:case 5:e="Loc_corner"}if(""==e)return;const t=this._locNode.find((t=>t.name.endsWith(e)));console.log(e),"Loc_corner"==e?(this.player.startRunAnim(),4==this._currentLoc?(this._currentLoc=3,this.characterRotate(Math.PI,(()=>{this._scene.beginDirectAnimation(this._collisionBox,this.createAlongXAnim(-t.position.x),0,ut.frameRate,!1,1,(()=>{this.characterRotate(-Math.PI/2,(()=>{this.player.startIdleAnim(),this.cameraRotateXAnim(Math.PI/4,(()=>{this.showArrow()}))}),4)}))}),4)):5==this._currentLoc&&(this._currentLoc=3,this.characterRotate(Math.PI,(()=>{this._scene.beginDirectAnimation(this._collisionBox,this.createAlongXAnim(-t.position.x),0,ut.frameRate,!1,1,(()=>{this.characterRotate(Math.PI/2,(()=>{this.player.startIdleAnim(),this.cameraRotateXAnim(Math.PI/4,(()=>{this.showArrow()}))}),4)}))}),4))):(this.player.startRunAnim(),this.characterRotate(Math.PI,(()=>{this._scene.beginDirectAnimation(this._collisionBox,this.createAlongZAnim(t.position.z),0,ut.frameRate,!1,1,(()=>{this.characterRotate(-Math.PI,(()=>{this.player.startIdleAnim(),this.showArrow()}),4)}))}),4)),this.hideAllArrow()}goLeft(){if(this.hideAllArrow(),1==this._currentLoc||2==this._currentLoc)1==this._currentLoc?this._visitStudioIndex=1:this._visitStudioIndex=2,this._viewDetail=!0,this.cameraMove(-Math.PI/2,-Math.PI/2,wt.CAMERA_MOVE_IN_DISTANCE,(()=>{this.showReturnArrow(),mt.setVisitStudioUiShowing(!0)}));else if(3==this._currentLoc){this._currentLoc=4;const e=this._locNode.find((e=>e.name.endsWith("Loc_3")));this.cameraRotateXAnim(-Math.PI/4,(()=>{this.player.startWalkAnim(),this.characterRotate(-Math.PI/2,(()=>{this._scene.beginDirectAnimation(this._collisionBox,this.createAlongXAnim(-e.position.x),0,ut.frameRate,!1,1,(()=>{this.player.startIdleAnim(),this.showArrow()}))}),4)}))}else 5==this._currentLoc&&(this._visitStudioIndex=6,this.cameraMove(-Math.PI/2,0,-6,(()=>{this.cameraRotateXAnim(Math.PI/3.5,(()=>{this.showReturnArrow(),mt.setVisitStudioUiShowing(!0)}))})))}goRight(){if(this.hideAllArrow(),1==this._currentLoc||2==this._currentLoc)1==this._currentLoc?this._visitStudioIndex=3:this._visitStudioIndex=4,this._viewDetail=!0,this.cameraMove(Math.PI/2,Math.PI/2,wt.CAMERA_MOVE_IN_DISTANCE,(()=>{this.showReturnArrow(),mt.setVisitStudioUiShowing(!0)}));else if(3==this._currentLoc){this._currentLoc=5;const e=this._locNode.find((e=>e.name.endsWith("Loc_4")));this.cameraRotateXAnim(-Math.PI/4,(()=>{this.player.startWalkAnim(),this.characterRotate(Math.PI/2,(()=>{this._scene.beginDirectAnimation(this._collisionBox,this.createAlongXAnim(-e.position.x),0,ut.frameRate,!1,1,(()=>{this.player.startIdleAnim(),this.showArrow()}))}),4)}))}else 4==this._currentLoc&&(this._visitStudioIndex=5,this.cameraMove(Math.PI/2,0,-6,(()=>{this.cameraRotateXAnim(Math.PI/3.5,(()=>{this.showReturnArrow(),mt.setVisitStudioUiShowing(!0)}))})))}characterRotate(e,t,i=1){this._scene.beginDirectAnimation(this._collisionBox,this.createRotateAnim(e),0,ut.frameRate,!1,i,(()=>{t()}))}cameraMove(e,t,i,s){this._scene.beginDirectAnimation(this.player.camera,this.createCameraDistanceAnim(i),0,ut.frameRate,!1,1,(()=>{this._scene.beginDirectAnimation(this._collisionBox,this.createRotateAnim(e),0,ut.frameRate,!1,1,(()=>{})),this._scene.beginDirectAnimation(this.player.cameraRotate,this.createCameraRotateYAnim(t),0,ut.frameRate,!1,1,s)}))}cameraMoveReverse(e,t,i,s){this._scene.beginDirectAnimation(this._collisionBox,this.createRotateAnim(e),0,ut.frameRate,!1,1,(()=>{this._scene.beginDirectAnimation(this.player.camera,this.createCameraDistanceAnim(i),0,ut.frameRate,!1,1,s)})),this._scene.beginDirectAnimation(this.player.cameraRotate,this.createCameraRotateYAnim(t),0,ut.frameRate,!1,1)}cameraRotateXAnim(e,t){this._scene.beginDirectAnimation(this.player.cameraRotate,this.createCameraRotateXAnim(e),0,ut.frameRate,!1,1,t)}backToPath(e){e?this.cameraMove(Math.PI/2,Math.PI/2,5):this.cameraMove(-Math.PI/2,-Math.PI/2,5)}showReturnArrow(){1==this._visitStudioIndex||2==this._visitStudioIndex||6==this._visitStudioIndex?this.arrowVisible(this._leftReturnArrow,!0):this.arrowVisible(this._rightReturnArrow,!0)}hideReturnArrow(){this.arrowVisible(this._leftReturnArrow,!1),this.arrowVisible(this._rightReturnArrow,!1)}showArrow(){this.arrowVisible(this._upArrow,!0),this.arrowVisible(this._downArrow,!0),this.arrowVisible(this._leftArrow,!0),this.arrowVisible(this._rightArrow,!0),0==this._currentLoc||1==this._currentLoc?this.arrowVisible(this._downArrow,!1):3==this._currentLoc?this.arrowVisible(this._upArrow,!1):4==this._currentLoc?(this.arrowVisible(this._leftArrow,!1),this.arrowVisible(this._upArrow,!1)):5==this._currentLoc&&(this.arrowVisible(this._rightArrow,!1),this.arrowVisible(this._upArrow,!1))}arrowVisible(e,t){e&&(e.isVisible=t)}hideAllArrow(){this.arrowVisible(this._upArrow,!1),this.arrowVisible(this._downArrow,!1),this.arrowVisible(this._leftArrow,!1),this.arrowVisible(this._rightArrow,!1),this.arrowVisible(this._leftReturnArrow,!1),this.arrowVisible(this._rightReturnArrow,!1)}createRotateAnim(e){const t=new h("rotateAnimation","rotation.y",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:this._collisionBox.rotation.y}),i.push({frame:ut.frameRate,value:this._collisionBox.rotation.y+e}),t.setKeys(i),[t]}goIntoStudio(e,t){1==e||2==e?(this.player.startWalkAnim(),this._scene.beginDirectAnimation(this._collisionBox,this.createAlongXAnim(this._collisionBox.position.x-3),0,ut.frameRate,!1,1,(()=>{this.player.startIdleAnim(),t&&t()}))):3==e||4==e?(this.player.startWalkAnim(),this._scene.beginDirectAnimation(this._collisionBox,this.createAlongXAnim(this._collisionBox.position.x+3),0,ut.frameRate,!1,1,(()=>{this.player.startIdleAnim(),t&&t()}))):(this.player.startWalkAnim(),this._scene.beginDirectAnimation(this._collisionBox,this.createAlongZAnim(this._collisionBox.position.z+3),0,ut.frameRate,!1,1,(()=>{this.player.startIdleAnim(),t&&t()})))}createAlongXAnim(e){const t=new h("walkAnim","position.x",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:this._collisionBox.position.x}),i.push({frame:ut.frameRate,value:e}),t.setKeys(i),[t]}createAlongZAnim(e){const t=new h("walkAnim","position.z",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:this._collisionBox.position.z}),i.push({frame:ut.frameRate,value:e}),t.setKeys(i),[t]}createCameraRotateYAnim(e){const t=new h("cameraAnimation","rotation.y",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:this.player.cameraRotate.rotation.y}),i.push({frame:ut.frameRate,value:this.player.cameraRotate.rotation.y+e}),t.setKeys(i),[t]}createCameraRotateXAnim(e){const t=new h("cameraAnimation","rotation.x",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:this.player.cameraRotate.rotation.x}),i.push({frame:ut.frameRate,value:this.player.cameraRotate.rotation.x+e}),t.setKeys(i),[t]}createCameraDistanceAnim(e){const t=new h("cameraDisAnimation","position.z",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),i=[];return i.push({frame:0,value:this.player.camera.position.z}),i.push({frame:ut.frameRate,value:this.player.camera.position.z+e}),t.setKeys(i),[t]}leftReturn(){this.hideReturnArrow(),mt.setVisitStudioUiShowing(!1),1==this._visitStudioIndex||2==this._visitStudioIndex?(this._viewDetail=!1,this.cameraMoveReverse(Math.PI/2,Math.PI/2,-1*wt.CAMERA_MOVE_IN_DISTANCE,(()=>{this.showArrow()}))):6==this._visitStudioIndex&&this.cameraRotateXAnim(-Math.PI/3.5,(()=>{this.cameraMove(Math.PI/2,0,6,(()=>{this.showArrow()}))}))}rightReturn(){this.hideReturnArrow(),mt.setVisitStudioUiShowing(!1),3==this._visitStudioIndex||4==this._visitStudioIndex?(this._viewDetail=!1,this.cameraMoveReverse(-Math.PI/2,-Math.PI/2,-1*wt.CAMERA_MOVE_IN_DISTANCE,(()=>{this.showArrow()}))):5==this._visitStudioIndex&&this.cameraRotateXAnim(-Math.PI/3.5,(()=>{this.cameraMove(-Math.PI/2,0,6,(()=>{this.showArrow()}))}))}};let vt=wt;vt.UP_ARROW="upArrow",vt.DOWN_ARROW="downArrow",vt.LEFT_ARROW="leftArrow",vt.RIGHT_ARROW="rightArrow",vt.LEFT_RETURN_ARROW="leftReturnArrow",vt.RIGHT_RETURN_ARROW="rightReturnArrow",vt.CAMERA_MOVE_IN_DISTANCE=-5;const Tt=class{constructor(e,i,s){this._collegeFloorInstances=[],this._cameraTarget=new t,this._animating=!1,this._visiting=!1,this._scene=e,this._collegeFloors=s,mt.collegeManager=this,mt.setFloorInfo(s),mt.setFloorTotalNumber(s.totalFloor),mt.setFloorUiShowing(!0),this._highLightLayer=new x("floorHighlightLayer",this._scene),this._currentFloorNum=-1,this._scene.collisionsEnabled=!0,this._web3DStudio=i,this._maxYPos=this._collegeFloors.totalFloor*ut.HEIGHT+100,this._visitPlayerManager=new vt(this._scene,Tt.PLAYER_MODEL_URL,Tt.PLAYER_ARROW_MODEL_URL)}async load(){this.setUpLight(),await this.loadModel(),await this._visitPlayerManager.loadPlayer(),this.invisiblePlayer(),this.setUpCamera()}setUpCamera(){const i=this._collegeFloors.totalFloor*ut.HEIGHT;this._cameraTarget=new t(0,i/2,20);const s=new e("camera",0,0,60,this._cameraTarget,this._scene);s.attachControl(),this._arcRotateCamera=s,this._scene.activeCamera=this._arcRotateCamera,this.beginStartCameraAnimation()}setUpLight(){new f("hemisphericLight",t.Up(),this._scene).intensity=1}async loadModel(){let e=await a.ImportMeshAsync("",Tt.FLOOR_MODEL_URL,void 0,this._scene);const t=e.meshes[0];this._collegeFloors.floors.forEach((e=>{const i=new ut(this._scene,this._web3DStudio,e,t,this._maxYPos);this._collegeFloorInstances.push(i)})),t.isVisible=!1,e.meshes.forEach((e=>{e.isVisible=!1,e.isPickable=!1}))}goToFloor(e){if(e!=this._currentFloorNum&&(mt.setVisitStudioUiShowing(!1),!this._animating))if(this._animating=!0,this._visiting&&(this._visiting=!1,this._scene.activeCamera=this._arcRotateCamera),this.invisiblePlayer(),this.hideVisitUi(),this.floorTranslucent(),-1!=e)if(-1==this._currentFloorNum){if(mt.setEveryFloorUiShowing(!1),e==this._collegeFloors.totalFloor)return this.updateCameraTarget(),this.floorStudioBoxVisible(e),this.floorVisible(e,(()=>{this._animating=!1,this.showVisitUi()})),this._currentFloorNum=e,void this.updateCameraTarget();for(let t=this._collegeFloors.totalFloor;t>e;t--){const i=this._collegeFloorInstances[t-1];t!=e+1?i.popToMaxHeight(300*(this._collegeFloors.totalFloor-t)):i.popToMaxHeight(300*(this._collegeFloors.totalFloor-t),(()=>{this.floorVisible(e,(()=>{this._animating=!1,this.showVisitUi()})),this.updateCameraTarget(),this.floorStudioBoxVisible(e)}))}this._currentFloorNum=e}else{if(this._currentFloorNum>e)for(let t=this._currentFloorNum;t>e;t--){const i=this._collegeFloorInstances[t-1];t!=e+1?i.popToMaxHeight(300*(this._currentFloorNum-t)):i.popToMaxHeight(300*(this._currentFloorNum-t),(()=>{this.floorVisible(e,(()=>{this._animating=!1,this.showVisitUi()})),this.updateCameraTarget(),this.floorStudioBoxVisible(e)}))}else for(let t=this._currentFloorNum+1;t<=e;t++){const i=this._collegeFloorInstances[t-1];t!=e?i.pushToOrigin(300*(t-this._currentFloorNum)):i.pushToOrigin(300*(t-this._currentFloorNum),(()=>{this.floorVisible(e,(()=>{this._animating=!1,this.showVisitUi()})),this.updateCameraTarget(),this.floorStudioBoxVisible(e)}))}this._currentFloorNum=e}else{for(let e=this._currentFloorNum+1;e<=this._collegeFloors.totalFloor;e++){const t=this._collegeFloorInstances[e-1];e!=this._collegeFloors.totalFloor?t.pushToOrigin(300*(e-this._currentFloorNum)):t.pushToOrigin(300*(e-this._currentFloorNum),(()=>{this._animating=!1,this._currentFloorNum=-1,this.updateCameraTarget(),mt.setEveryFloorUiShowing(!0)}))}this._currentFloorNum+1>this._collegeFloors.totalFloor&&(this._animating=!1,this._currentFloorNum=-1,this.updateCameraTarget(),mt.setEveryFloorUiShowing(!0))}}floorVisible(e,t){this._collegeFloorInstances[e-1].floorVisible(t)}floorStudioBoxVisible(e){const t=this._collegeFloorInstances[e-1];t.visibleStudioBox(),this._ui=r.CreateFullscreenUI("floorUi",!0,this._scene),t.showStudioName(this._ui),t.setHighLight(this._highLightLayer),t.showUnnecessary()}floorTranslucent(){var e;null==(e=this._ui)||e.dispose(),this._collegeFloorInstances.forEach((e=>{e.translucent(),e.invisibleStudioBox(),e.hideUnnecessary()}))}hideVisitUi(){mt.setVisitUiShowing(!1)}showVisitUi(){mt.setVisitUiShowing(!0)}updateCameraTarget(){this._scene.beginDirectAnimation(this._arcRotateCamera,this.createCameraAnim(),0,2*ut.frameRate,!1)}createCameraAnim(){const e=new h("targetAnimation","target",ut.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT),i=[],s=-1==this._currentFloorNum?this._collegeFloors.totalFloor*ut.HEIGHT:this._currentFloorNum*ut.HEIGHT,o=-1==this._currentFloorNum?new t(0,s/2,20):new t(0,s,15);i.push({frame:0,value:this._arcRotateCamera.target}),i.push({frame:2*ut.frameRate,value:o}),e.setKeys(i);const a=new h("cameraBetaAnimation","beta",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),n=[];n.push({frame:0,value:this._arcRotateCamera.beta}),-1==this._currentFloorNum?n.push({frame:2*ut.frameRate,value:Math.PI/3}):n.push({frame:2*ut.frameRate,value:Math.PI/4}),a.setKeys(n);const r=new h("cameraAlphaAnimation","alpha",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),l=[];l.push({frame:0,value:this._arcRotateCamera.alpha}),-1==this._currentFloorNum?l.push({frame:2*ut.frameRate,value:-(Math.PI/2+Math.PI/4)}):l.push({frame:2*ut.frameRate,value:-Math.PI/2}),r.setKeys(l);const c=new U;c.setEasingMode(m.EASINGMODE_EASEOUT),e.setEasingFunction(c);const u=new h("cameraRadiusAnimation","radius",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),d=[],_=-1==this._currentFloorNum?60:50;return d.push({frame:0,value:this._arcRotateCamera.radius}),d.push({frame:2*ut.frameRate,value:_}),u.setKeys(d),[e,r,a,u]}beginStartCameraAnimation(){this._scene.beginDirectAnimation(this._arcRotateCamera,this.createCameraAnim(),0,2*ut.frameRate,!1)}disposeStudioNameUi(){var e;null==(e=this._ui)||e.dispose()}createStartCameraAnim(){const e=new h("cameraBetaAnimation","beta",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),t=[];t.push({frame:0,value:this._arcRotateCamera.beta}),t.push({frame:2*ut.frameRate,value:Math.PI/3}),e.setKeys(t);const i=new h("cameraAlphaAnimation","alpha",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),s=[];return s.push({frame:0,value:this._arcRotateCamera.alpha}),s.push({frame:2*ut.frameRate,value:-(Math.PI/2+Math.PI/4)}),i.setKeys(s),[i,e]}cameraSmoothOut(){this._visiting||this._scene.beginDirectAnimation(this._arcRotateCamera,this.createCameraOutAnim(),0,ut.frameRate,!1)}createCameraOutAnim(){const e=new h("cameraRadiusAnimation","radius",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),t=[];t.push({frame:0,value:this._arcRotateCamera.radius}),t.push({frame:ut.frameRate,value:this._arcRotateCamera.radius+2});const i=new D;return i.setEasingMode(m.EASINGMODE_EASEOUT),e.setEasingFunction(i),e.setKeys(t),[e]}cameraSmoothIn(){this._visiting||this._scene.beginDirectAnimation(this._arcRotateCamera,this.createCameraInAnim(),0,ut.frameRate,!1)}createCameraInAnim(){const e=new h("cameraRadiusAnimation","radius",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),t=[];t.push({frame:0,value:this._arcRotateCamera.radius}),t.push({frame:ut.frameRate,value:this._arcRotateCamera.radius-2});const i=new D;return i.setEasingMode(m.EASINGMODE_EASEOUT),e.setEasingFunction(i),e.setKeys(t),[e]}visitFloor(){if(-1==this._currentFloorNum)return;const e=this._collegeFloorInstances[this._currentFloorNum-1];e.loadTexture(),this._visitPlayerManager.locTransformNode=e.locTransformNode,this._visiting=!0,this.hideOtherFloor(),this.hideVisitUi(),this.placeVisitPlayer(),this.visiblePlayer(),this._scene.beginDirectAnimation(this._arcRotateCamera,this.createCameraMoveToPlayerAnim(),0,2*ut.frameRate,!1,void 0,(()=>{this._visitPlayerManager.turnOnCamera()})),this.disposeStudioNameUi()}createCameraMoveToPlayerAnim(){const e=new h("targetAnimation","target",ut.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT),i=[],s=(this._currentFloorNum-1)*ut.HEIGHT,o=new t(0,s,15);this._arcRotateCamera.target=o,i.push({frame:0,value:this._arcRotateCamera.target.clone()}),i.push({frame:2*ut.frameRate,value:o}),e.setKeys(i);const a=new U;a.setEasingMode(m.EASINGMODE_EASEOUT),e.setEasingFunction(a);const n=new h("cameraBetaAnimation","beta",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),r=[];r.push({frame:0,value:this._arcRotateCamera.beta}),r.push({frame:2*ut.frameRate,value:Math.PI/2-Math.PI/24.3}),n.setKeys(r);const l=new h("cameraAlphaAnimation","alpha",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),c=[];c.push({frame:0,value:this._arcRotateCamera.alpha}),c.push({frame:2*ut.frameRate,value:-Math.PI/2}),l.setKeys(c);const u=new h("cameraXRadiusAnimation","radius",ut.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),d=[];return d.push({frame:0,value:this._arcRotateCamera.radius}),d.push({frame:2*ut.frameRate,value:24}),u.setKeys(d),[e,u,l,n]}placeVisitPlayer(){this._visitPlayerManager.placePlayerAtFloor(this._currentFloorNum)}invisiblePlayer(){console.log("不可见"),this._visitPlayerManager.invisible()}visiblePlayer(){this._visitPlayerManager.visible()}hideOtherFloor(){for(let e=1;e<=this._collegeFloors.totalFloor;e++)if(e!=this._currentFloorNum){this._collegeFloorInstances[e-1].hide()}}goToStudio(){this._collegeFloorInstances[this._currentFloorNum-1].openDoor(this._visitPlayerManager._visitStudioIndex,(()=>{this._visitPlayerManager.goIntoStudio(this._visitPlayerManager._visitStudioIndex,(()=>{const e=this._collegeFloors.floors[this._currentFloorNum-1].studios[this._visitPlayerManager._visitStudioIndex-1].uuid;console.log("点击进入"),this._web3DStudio.goToStudio(e)}))}))}openStudioDoor(){if(-1==this._currentFloorNum)return;const e=this._collegeFloorInstances[this._currentFloorNum-1];for(let t=1;t<=6;t++)e.openDoor(t)}};let kt=Tt;kt.PLAYER_MODEL_URL="model/player.glb",kt.PLAYER_ARROW_MODEL_URL="model/player_arrow.glb",kt.FLOOR_MODEL_URL="model/floor.glb";const yt=[{uuid:1,area:"A_Area",videoName:"JVM内存模型",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/videoBook/MemoryModel.png",thickness:1},{uuid:2,area:"A_Area",videoName:"JVM体系结构",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_2.png",thickness:1},{uuid:3,area:"A_Area",videoName:"",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_3.png",thickness:.5},{uuid:4,area:"A_Area",videoName:"指令重排序",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/videoBook/InstructionReorder.png",thickness:1},{uuid:5,area:"A_Area",videoName:"类加载器及双亲委派机制",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_3.png",thickness:.5},{uuid:6,area:"A_Area",videoName:"Native，方法区",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_5.png",thickness:1},{uuid:7,area:"A_Area",videoName:"JVM虚拟机",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_5.png",thickness:.8},{uuid:8,area:"B_Area",videoName:"JVM内存屏障",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/videoBook/MemoryBarrier.png",thickness:.55},{uuid:9,area:"A_Area",videoName:"JVM虚拟机",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_3.png",thickness:.5},{uuid:10,area:"B_Area",videoName:"JVM虚拟机",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_5.png",thickness:.8},{uuid:11,area:"A_Area",videoName:"JVM虚拟机",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_5.png",thickness:.7},{uuid:12,area:"C_Area",videoName:"JAVA数组",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_4.png",thickness:.6},{uuid:13,area:"D_Area",videoName:"JVM虚拟机",videoURL:"video/javaVideo_1.flv",textureImgURL:"img/bookCover/book_5.png",thickness:.5}];const Et=new class{constructor(){this.books=yt,this.currentBook=null,this.currentBookDetail=null,this.videoShowing=!1,this.shelfShowing=!1,this.web3DStudio=null,I(this,{web3DStudio:!1,currentBook:!1,setBookWithDetail:!1,currentBookDetail:!1})}setBookWithDetail(e,t){this.currentBook=e,this.currentBookDetail=t}setVideoShowing(e){this.videoShowing=e}setShelfShowing(e){this.shelfShowing=e}};var bt,Nt,St,Mt,Rt,It;(Nt=bt||(bt={}))[Nt.UnFinished=0]="UnFinished",Nt[Nt.Finished=1]="Finished",Nt[Nt.OnProgress=2]="OnProgress",(Mt=St||(St={}))[Mt.NotAccept=0]="NotAccept",Mt[Mt.OnProgress=1]="OnProgress",Mt[Mt.Finished=2]="Finished",(It=Rt||(Rt={}))[It.video=0]="video",It[It.practice=1]="practice",It[It.read=2]="read";const Ot=[{uuid:1,name:"任务1",description:"从零入门Spring框架，学习IOC(DI)和AOP思想",status:2,goal:"学习了解Spring框架,初识后端开发",subTask:[{status:1,name:"子任务1",type:0,description:"学习安装SpringBoot",rate:4,progress:100,studyUuid:0},{status:1,name:"子任务2",type:1,description:"搭建一个基本的Restful风格的后端",rate:3,progress:100,studyUuid:0},{status:1,name:"子任务2",type:1,description:"搭建一个基本的Restful风格的后端",rate:3,progress:100,studyUuid:0},{status:2,name:"子任务2",type:1,description:"搭建一个基本的Restful风格的后端",rate:3,progress:100,studyUuid:0},{status:0,name:"子任务2",type:1,description:"搭建一个基本的Restful风格的后端",rate:3,progress:100,studyUuid:0},{status:0,name:"子任务2",type:1,description:"搭建一个基本的Restful风格的后端",rate:3,progress:100,studyUuid:0}],rate:3.5},{uuid:2,description:"Java高并发学习，手写底层高并发控件",name:"Java高并发编程系列",goal:"从底层学习Java高并发的有关知识,了解高并发原理",status:0,subTask:[{name:"Java循环",status:0,type:1,studyUuid:1,progress:0,description:"哈哈"},{name:"Java条件语句",status:0,type:1,studyUuid:2,progress:0,description:"哈哈"},{name:"Java并发",status:0,type:1,studyUuid:3,progress:0,description:"哈哈"},{name:"JVM内存模型",description:"解析jvm虚拟机底层的内存模型",type:0,status:0,progress:0,studyUuid:1},{name:"指令重排序",description:"解析jvm的指令重排序机制",type:0,status:0,progress:0,studyUuid:4},{name:"JVM内存屏障",description:"JVM内存屏障解析",type:0,status:0,progress:0,studyUuid:8}]},{uuid:3,description:"JVM虚拟机学习，快速入门JVM虚拟机",name:"JVM虚拟机系列",goal:"明白类加载器,堆,栈的区别.新生代,老年代是干什么的",status:0,subTask:[{name:"JVM体系结构",description:"解析jvm虚拟机底层的内存模型",type:0,status:0,progress:0,studyUuid:4},{name:"类加载器及双亲委派机制",description:"解析jvm的类加载器",type:0,status:0,progress:0,studyUuid:5},{name:"Native，方法区",description:"解析jvm的方法区中有什么",type:0,status:0,progress:0,studyUuid:6}]},{uuid:4,description:"JAVA8有lambda等新特性...",name:"JAVA8系列",goal:"熟悉了解JAVA8的语法,能熟练应用于项目当中",status:0,subTask:[{name:"Lambda表达式",description:"什么是lambda表达式",type:2,status:0,progress:0,studyUuid:1},{name:"Java8实战",description:"Java8实战",type:2,status:0,progress:0,studyUuid:2},{name:"Native，方法区",description:"解析jvm的方法区中有什么",type:0,status:0,progress:0,studyUuid:6}]}];const Pt=new class{constructor(){this.isShowing=!1,this.taskList=Ot,I(this)}setShowing(e){this.isShowing=e}acceptTask(e){this.taskList.forEach((t=>{if(t.uuid==e){t.status=1;const e=Dt.receptionistManager,i=Dt.studioManager;if(t.subTask.length>=1){switch(t.subTask[0].type){case 0:null==e||e.playVideoHintSound(),null==i||i.setHighLightBookShelf(!0);break;case 2:null==e||e.playReadingHintSound(),null==i||i.setHighlightPracticeTable(!0);break;case 1:null==e||e.playExerciseHintSound(),null==i||i.setHighlightPracticeTable(!0)}t.subTask[0].status=2}Dt.setCurrentTask(t)}}))}get unAcceptTask(){return this.taskList.filter((e=>0==e.status))}get finishedTask(){return this.taskList.filter((e=>2==e.status))}},Ct=[{uuid:1,bookName:"Java8函数式编程",bookURL:"pdf/Functional_programming-22-25.pdf",textureImgURL:"img/bookCover/eBook/Functional_programming.png",thickness:1},{uuid:2,bookName:"Java8实战",bookURL:"pdf/java8practice-22-26.pdf",textureImgURL:"img/bookCover/eBook/java_practice.png",thickness:1},{uuid:3,bookName:"Java并发编程艺术",bookURL:"pdf/Concurrent_programming_art-15-19.pdf",textureImgURL:"img/bookCover/eBook/Concurrent_programming_art.png",thickness:1},{uuid:4,bookName:"深入理解Java虚拟机",bookURL:"pdf/DeepUnderstandingOfJVM-253-257.pdf",textureImgURL:"img/bookCover/eBook/DeepUnderstandingOfJVM.png",thickness:1},{uuid:5,bookName:"Java编程思想",bookURL:"pdf/java8practice-88-93.pdf",textureImgURL:"img/bookCover/eBook/think_in_java.png",thickness:1},{uuid:6,bookName:"Effective Java中文版",bookURL:"pdf/java8practice-88-93.pdf",textureImgURL:"img/bookCover/eBook/Effective_Java.png",thickness:1}];var Lt,Bt;(Bt=Lt||(Lt={}))[Bt.choice=0]="choice",Bt[Bt.fillInBlank=1]="fillInBlank",Bt[Bt.code=2]="code",Bt[Bt.questions=3]="questions";const xt=[{uuid:1,name:"Java循环练习题",description:"Java循环练习题",subTasks:[{name:"以下那个关键字不能用于循环",type:0,choice:["while","for","forEach","if"],score:5},{name:"写出能用于循环的关键字",type:1,score:5},{name:"写出Java语言1+2+3+...+100的代码",type:2,score:5},{name:"分析二重循环的时间复杂度",type:3,score:5}]},{uuid:2,name:"Java条件语句练习题",description:"Java条件语句练习题",subTasks:[{name:"写出能用于条件语句的关键字",type:1,score:5},{name:"以下那个关键字不能用于条件判断",type:0,choice:["if","else if","else ","while"],score:5},{name:"写出输入一个年份判断是不是闰年的代码",type:2,score:5},{name:"解读下面代码的意思",type:3,score:5}]},{uuid:3,name:"Java并发练习题",description:"Java并发练习题",subTasks:[{name:"Java中用到的线程调度算法是什么",type:1,score:5},{name:"写出Java中各种锁的类型",type:1,score:5},{name:"写一个程序，线程C在线程B后执行，线程B在线程A之后进行",type:2,score:5}]}];const Ut=new class{constructor(){this.eBooks=Ct,this.currentEBook=null,this.currentEBookDetail={uuid:-1,bookName:"Java工作室",bookURL:"pdf/Java.pdf",textureImgURL:"",thickness:1},this.currentPractice=null,this.currentPracticeDetail=xt[0],this.practiceAnswer=[],this.web3DStudio=null,this.practiceTable=null,this.eBookReaderShowing=!1,this.practiceShowing=!1,this.practiceTableShowing=!1,I(this,{currentEBook:!1,currentEBookDetail:!1,setEBookWithDetail:!1,fetchPracticeTask:!1,practiceAnswer:!1,submit:!1,unFinishedPracticeCount:!1,web3DStudio:!1,practiceTable:!1,setPracticeTable:!1})}setPracticeTable(e){this.practiceTable=e}async getPracticeTaskDetail(e){const t=await this.fetchPracticeTask(e);F((()=>{this.currentPracticeDetail=t,this.practiceAnswer.splice(0,this.practiceAnswer.length);for(let e=0;e<this.currentPracticeDetail.subTasks.length;e++)this.practiceAnswer.push({answer:""});console.log("找到练习任务",t)}))}setCurrentPractice(e){console.log("设置当前练习"),this.currentPractice=e,this.getPracticeTaskDetail(e.studyUuid)}async fetchPracticeTask(e){return xt.find((t=>t.uuid==e))}setEBookWithDetail(e,t){this.currentEBook=e,this.currentEBookDetail=t}setPracticeTableShowing(e){this.practiceTableShowing=e}setEBookReaderShowing(e){this.eBookReaderShowing=e,this.practiceTableShowing=!e}setPracticeShowing(e){this.practiceShowing=e,this.practiceTableShowing=!e}submit(){const e=Dt;console.log("提交的答案",this.practiceAnswer),e.updateCurrentSubTaskProgress(Rt.practice,this.currentPractice.studyUuid,100)}get unFinishedPracticeCount(){let e=0;return this.practiceAnswer.forEach((t=>{""==t.answer&&e++})),e}};const Dt=new class{constructor(){this.receptionistManager=null,this.studioManager=null,this.staircase=null,this.isShowing=!0,this.currentTask={name:"空任务",uuid:-1,status:St.NotAccept,description:"",goal:"",subTask:[]},this.currentSubTaskIndex=-1,this.isShowingDialog=!1,this.dialog={avatarURL:"",title:"",info:""},I(this,{staircase:!1,setStairCase:!1,currentSubTaskIndex:!1,receptionistManager:!1,setReceptionistManager:!1,studioManager:!1,setStudioManager:!1,currentSubTaskVideoUUID:!1,playSoundAndHighLight:!1})}setDialogShowing(e){this.isShowingDialog=e}setDialogInfo(e){this.dialog=e}playSoundAndHighLight(e){var t,i,s,o,a,n,r,l,h;switch(null==(t=this.studioManager)||t.setHighLightBookShelf(!1),null==(i=this.studioManager)||i.setHighlightPracticeTable(!1),null==(s=this.studioManager)||s.setHighlightPracticeTable(!1),this.currentTask.subTask[e].type){case Rt.video:null==(o=this.receptionistManager)||o.playVideoHintSound(),null==(a=this.studioManager)||a.setHighLightBookShelf(!0);break;case Rt.read:null==(n=this.receptionistManager)||n.playReadingHintSound(),null==(r=this.studioManager)||r.setHighlightPracticeTable(!0);break;case Rt.practice:null==(l=this.receptionistManager)||l.playExerciseHintSound(),null==(h=this.studioManager)||h.setHighlightPracticeTable(!0)}}setCurrentTask(e){this.isShowing=!0,e.subTask.forEach(((e,t)=>{e.status==bt.OnProgress&&(this.currentSubTaskIndex=t)})),this.currentTask=e,this.updatePracticeTableButton()}updatePracticeTableButton(){const e=Ut;e.practiceTable&&e.practiceTable.updatePracticeButton()}setShowing(e){this.isShowing=e}setStairCase(e){this.staircase=e}setReceptionistManager(e){this.receptionistManager=e}setStudioManager(e){this.studioManager=e}finishSubTask(e,t=bt.Finished){var i;if(!(e>=this.currentTask.subTask.length)){if(this.currentTask.subTask[e].status=t,this.currentTask.subTask[e].rate=5,this.staircase&&(console.log("调用楼梯的moveNext"),this.staircase.moveToNext()),e++,H.success({message:"子任务完成",description:`${this.currentTask.subTask[e-1].name} 完成,评分${this.currentTask.subTask[e-1].rate}`,placement:"topLeft",onClose:()=>{e<this.currentTask.subTask.length&&this.playSoundAndHighLight(this.currentSubTaskIndex)},duration:3}),this.updatePracticeTableButton(),e>=this.currentTask.subTask.length){const e=this.currentTask.subTask.reduce(((e,t)=>e+t.rate),0)/this.currentTask.subTask.length;return this.currentTask.rate=e,null==(i=this.receptionistManager)||i.playTaskFinishedHintSound(),H.success({message:"任务完成",description:`${this.currentTask.name} 完成,评分${this.currentTask.rate}`,placement:"topLeft"}),this.currentSubTaskIndex=-1,void this.turnOffAllHighLight()}this.currentTask.subTask[e].status=bt.OnProgress,this.currentSubTaskIndex=e}}turnOffAllHighLight(){var e,t,i;null==(e=this.studioManager)||e.setHighLightBookShelf(!1),null==(t=this.studioManager)||t.setHighlightPracticeTable(!1),null==(i=this.studioManager)||i.setHighlightPracticeTable(!1)}updateCurrentSubTaskProgress(e,t,i){if(this.currentTask.uuid>=0){const s=this.currentTask.subTask[this.currentSubTaskIndex];s.studyUuid==t&&s.type==e&&(this.currentTask.subTask[this.currentSubTaskIndex].progress=i,100==i&&this.finishSubTask(this.currentSubTaskIndex))}}get currentSubTaskVideoUUID(){return this.currentTask.uuid>=0&&(console.log("子任务编号",this.currentSubTaskIndex),this.currentSubTaskIndex>=0&&this.currentSubTaskIndex<this.currentTask.subTask.length&&(console.log(this.currentSubTaskIndex),this.currentTask.subTask[this.currentSubTaskIndex].type==Rt.video))?this.currentTask.subTask[this.currentSubTaskIndex].studyUuid:null}get currentSubTaskEBookUUID(){return this.currentTask.uuid>=0&&this.currentSubTaskIndex>=0&&this.currentSubTaskIndex<this.currentTask.subTask.length&&this.currentTask.subTask[this.currentSubTaskIndex].type==Rt.read?this.currentTask.subTask[this.currentSubTaskIndex].studyUuid:null}get currentPracticeSubTask(){let e=[];return this.currentTask.subTask.forEach((t=>{t.status!=bt.OnProgress&&t.status!=bt.UnFinished||t.type!=Rt.practice||e.push(t)})),console.log("返回练习任务",e),e}};var Ft,Ht;(Ht=Ft||(Ft={}))[Ht.init=0]="init",Ht[Ht.outing=1]="outing",Ht[Ht.done=2]="done",Ht[Ht.ining=3]="ining",Ht[Ht.cameraOut=4]="cameraOut",Ht[Ht.camera=5]="camera",Ht[Ht.cameraIn=6]="cameraIn";const Vt=class{constructor(e,i,s,n,r,l){this._state=0,this._callback=(e,t,i,s,o)=>{var a,n,r,l;e[0].parent=this.bookNode,this.bookNode.rotation.x=-Math.PI/2,this.bookNode.scaling.y=this._bookDetail.thickness,e[1];const h=e[2];this._shadowGenerator.addShadowCaster(e[0],!0);const c=Dt;this._scene.registerBeforeRender((()=>{const e=c.currentSubTaskVideoUUID;e&&e==this._bookDetail.uuid?this._highLightLayer.addMesh(h,E.Green()):this._highLightLayer.removeMesh(h)})),this.bookNode.position.copyFrom(this._position);const u=Et;if(this._openBookAnim=s.find((e=>"OpenBook"==e.name)),null==(a=this._openBookAnim)||a.onAnimationGroupEndObservable.add((()=>{5==this._state&&(u.setBookWithDetail(this,this._bookDetail),u.setVideoShowing(!0))})),null==(n=this._openBookAnim)||n.stop(),this._closeBookAnim=s.find((e=>"CloseBook"==e.name)),null==(r=this._closeBookAnim)||r.onAnimationGroupEndObservable.add((()=>{this.moveToOriginStepTwo()})),null==(l=this._closeBookAnim)||l.stop(),""!=this._bookDetail.textureImgURL){const e=new R(this._bookDetail.textureImgURL,this._scene),t=new y(`book-${this._bookDetail.uuid}-CoverMat`,this._scene);t.specularColor=E.Black(),t.diffuseTexture=e,h.material=t}h.actionManager=new v(this._scene),h.actionManager.registerAction(new T(v.OnPointerOverTrigger,(()=>{this.hoverOut()}))),h.actionManager.registerAction(new T(v.OnPointerOutTrigger,(()=>{this.hoverIn()}))),h.actionManager.registerAction(new T(v.OnPickDownTrigger,(()=>{var e;2==this._state&&(null==(e=this.hoverOutAnim)||e.stop(),this.cameraOutAnim=this._scene.beginDirectAnimation(this.bookNode,this.createMoveToCamera(),0,2*Vt.frameRate,!1,void 0,(()=>{var e;this._state=5,this.playOpenBook(),null==(e=this.cameraOutAnim)||e.stop(),this._bookSound.playOpenBookSound()})),this._state=4)})))},this._scene=e,this._bookDetail=i,this._position=s,this._bookSound=n,this._shadowGenerator=r,this._highLightLayer=l,this._targetCameraPos=new t(-2.2,1.25,0),this._targetPos=new t(s.x-.15,s.y,s.z),this.bookNode=new o(`book-${i.uuid}`,this._scene),a.ImportMesh("",Vt.BOOK_URL,void 0,this._scene,this._callback)}moveToOriginStepOne(){var e;5==this._state&&(null==(e=this.cameraOutAnim)||e.stop(),this.playCloseBook())}moveToOriginStepTwo(){5==this._state&&(this._bookSound.playCloseBookSound(),this.cameraInAnim=this._scene.beginDirectAnimation(this.bookNode,this.createMoveIn(),0,2*Vt.frameRate,!1,void 0,(()=>{this._state=0})),this._state=6)}playOpenBook(){var e;Et.setShelfShowing(!1),null==(e=this._openBookAnim)||e.play(!1)}playCloseBook(){var e;null==(e=this._closeBookAnim)||e.play(!1)}hoverOut(){var e;0!=this._state&&3!=this._state||(null==(e=this.hoverInAnim)||e.stop(),this.hoverOutAnim=this._scene.beginDirectAnimation(this.bookNode,this.createHoverOutAnimation(),0,Vt.frameRate,!1,void 0,(()=>{this._state=2})),this._bookSound.playClickBookSound(),this._state=1)}hoverIn(){var e;1!=this._state&&2!=this._state||(null==(e=this.hoverOutAnim)||e.stop(),this.hoverInAnim=this._scene.beginDirectAnimation(this.bookNode,this.createHoverInAnimation(),0,Vt.frameRate,!1,void 0,(()=>{this._state=0})),this._state=3)}createHoverOutAnimation(){let e=new h("hoverOut","position",Vt.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT);const t=[];console.log("hoverOutAnim",this.bookNode.position,this._targetPos),t.push({frame:0,value:this.bookNode.position}),t.push({frame:30,value:this._targetPos});let i=new u;return i.setEasingMode(m.EASINGMODE_EASEOUT),e.setEasingFunction(i),e.setKeys(t),[e]}createHoverInAnimation(){let e=new h("hoverIn","position",Vt.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT);const t=[];t.push({frame:0,value:this.bookNode.position}),t.push({frame:30,value:this._position});let i=new u;return i.setEasingMode(m.EASINGMODE_EASEIN),e.setEasingFunction(i),e.setKeys(t),[e]}createMoveToCamera(){const e=new h("moveAnim","position",Vt.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT),i=[];i.push({frame:0,value:this.bookNode.position}),i.push({frame:15,value:this._targetPos.add(new t(-.3,0,0))}),i.push({frame:60,value:this._targetCameraPos}),i.push({frame:120,value:this._targetCameraPos}),e.setKeys(i);const s=new h("rotateYAnim","rotation.y",Vt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:this.bookNode.rotation.y}),o.push({frame:60,value:Math.PI/2}),s.setKeys(o);const a=new h("rotateXAnim","rotation.x",Vt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),n=[];return n.push({frame:60,value:this.bookNode.rotation.x}),n.push({frame:90,value:-Math.PI/2.5}),a.setKeys(n),[s,a,e]}createMoveIn(){const e=new h("moveAnimReverse","position",Vt.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT),i=[];i.push({frame:0,value:this.bookNode.position}),i.push({frame:40,value:this.bookNode.position}),i.push({frame:100,value:this._targetPos.add(new t(-.5,0,0))}),i.push({frame:120,value:this._position}),e.setKeys(i);const s=new h("rotateXAnimReverse","rotation.x",Vt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:this.bookNode.rotation.x}),o.push({frame:60,value:-Math.PI/2}),s.setKeys(o);const a=new h("rotateYAnimReverse","rotation.y",Vt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),n=[];return n.push({frame:60,value:this.bookNode.rotation.y}),n.push({frame:100,value:0}),a.setKeys(n),[s,a,e]}};let Gt=Vt;Gt.BOOK_URL="model/book.glb",Gt.frameRate=60;const $t=class{constructor(e){this._bookLocName={A_Area:"BookLocA",B_Area:"BookLocB",C_Area:"BookLocC",D_Area:"BookLocD"},this._bookLocTransformNode={A_Area:[],B_Area:[],C_Area:[],D_Area:[]},this._count=new Map,this._scene=new V(e),this._scene.autoClear=!1;new f("bookShelfHemisphericLight",t.Up(),this._scene).intensity=.6,this._directionalLight=new A("bookShelfLight",new t(1,-1,1),this._scene),this._directionalLight.intensity=.7,this._shadowGenerator=new G(1024,this._directionalLight),this._shadowGenerator.stabilizeCascades=!0,this._shadowGenerator.forceBackFacesOnly=!0,this._shadowGenerator.shadowMaxZ=20,this._shadowGenerator.autoCalcDepthBounds=!0,this._shadowGenerator.lambda=.5,this._shadowGenerator.depthClamp=!0,this._shadowGenerator.penumbraDarkness=.8,this._shadowGenerator.usePercentageCloserFiltering=!0,this._shadowGenerator.filteringQuality=w.QUALITY_HIGH,this._highLightLayer=new x("bookShelfHighLightLayer",this._scene),this.setUpSound(),this.setUpCamera(),this.setUpShelf()}render(){this._scene.render()}setUpCamera(){const i=new e("camera",Math.PI,Math.PI/2.4,2.8,new t(0,.8,0),this._scene);i.minZ=.1,i.wheelPrecision=50}setUpShelf(){a.ImportMesh("",$t.BOOK_SHELF_URL,void 0,this._scene,((e,t,i,s,o)=>{e.forEach((e=>{this._shadowGenerator.addShadowCaster(e),e.receiveShadows=!0})),o.forEach((e=>{this.initCount(e),e.name.startsWith(this._bookLocName.A_Area)?this._bookLocTransformNode.A_Area.push(e):e.name.startsWith(this._bookLocName.B_Area)?this._bookLocTransformNode.B_Area.push(e):e.name.startsWith(this._bookLocName.C_Area)?this._bookLocTransformNode.C_Area.push(e):e.name.startsWith(this._bookLocName.D_Area)&&this._bookLocTransformNode.D_Area.push(e)}));Et.books.forEach((e=>{switch(e.area){case"A_Area":this.placeBook(e,this._bookLocTransformNode.A_Area);break;case"B_Area":this.placeBook(e,this._bookLocTransformNode.B_Area);break;case"C_Area":this.placeBook(e,this._bookLocTransformNode.C_Area);break;case"D_Area":this.placeBook(e,this._bookLocTransformNode.D_Area)}}))}))}placeBook(e,i){console.log("开始放置书籍");for(let s=0;s<i.length;s++){const o=i[s],a=this._count.get(o);if(console.log(a),null!=a&&a<$t.MAX_PLACE){this._count.set(o,a+1);const i=new t(-o.position.x,o.position.y,o.position.z-.1*a);new Gt(this._scene,e,i,this,this._shadowGenerator,this._highLightLayer);break}}}initCount(e){this._count.set(e,0)}setUpSound(){this._openBookSound=new g("openBookSound","sound/book/openBook.mp3",this._scene,(()=>{}),{loop:!1,autoplay:!1}),this._closeBookSound=new g("closeBookSound","sound/book/closeBook.mp3",this._scene,(()=>{}),{loop:!1,autoplay:!1}),this._clickBookSound=new g("clickBookSound","sound/book/clickBook.mp3",this._scene,(()=>{}),{loop:!1,autoplay:!1,volume:.2})}playCloseBookSound(){var e;null==(e=this._closeBookSound)||e.play()}playOpenBookSound(){var e;null==(e=this._openBookSound)||e.play()}playClickBookSound(){var e;null==(e=this._clickBookSound)||e.play()}};let Wt=$t;var zt;Wt.MAX_PLACE=3,Wt.BOOK_SHELF_URL="model/bookShelf.glb",function(e){e[e.init=0]="init",e[e.outing=1]="outing",e[e.done=2]="done",e[e.ining=3]="ining",e[e.cameraOut=4]="cameraOut",e[e.camera=5]="camera",e[e.cameraIn=6]="cameraIn"}(zt||(zt={}));const Yt=class{constructor(e,i,s,n,r,l){this._state=0,this._callback=(e,t,i,s,o)=>{var a,n,r,l;e[0].parent=this._eBookNode;const h=e[1],c=e[2];this._shadowGenerator.addShadowCaster(h),this._shadowGenerator.addShadowCaster(c);const u=Dt;this._scene.registerBeforeRender((()=>{const e=u.currentSubTaskEBookUUID;e&&e==this._eBook.uuid?this._highLightLayer.addMesh(c,E.Green()):this._highLightLayer.removeMesh(c)}));const m=Ut;if(this._openBookAnim=s.find((e=>"OpenBook"==e.name)),null==(a=this._openBookAnim)||a.onAnimationGroupEndObservable.add((()=>{5==this._state&&(m.setEBookWithDetail(this,this._eBook),m.setEBookReaderShowing(!0))})),null==(n=this._openBookAnim)||n.stop(),this._closeBookAnim=s.find((e=>"CloseBook"==e.name)),null==(r=this._closeBookAnim)||r.onAnimationGroupEndObservable.add((()=>{this.moveToOriginStepTwo()})),null==(l=this._closeBookAnim)||l.stop(),""!=this._eBook.textureImgURL){const e=new R(this._eBook.textureImgURL,this._scene),t=new y(`eBook-${this._eBook.uuid}-CoverMat`,this._scene);t.specularColor=E.Black(),t.diffuseTexture=e,c.material=t}c.actionManager=new v(this._scene),c.actionManager.registerAction(new T(v.OnPointerOverTrigger,(()=>{this.hoverOut()}))),c.actionManager.registerAction(new T(v.OnPointerOutTrigger,(()=>{this.hoverIn()}))),c.actionManager.registerAction(new T(v.OnPickDownTrigger,(()=>{var e;2==this._state&&(null==(e=this.hoverOutAnim)||e.stop(),this.cameraOutAnim=this._scene.beginDirectAnimation(this._eBookNode,this.createMoveToCamera(),0,2*Yt.frameRate,!1,void 0,(()=>{var e;this._state=5,this.playOpenBook(),null==(e=this.cameraOutAnim)||e.stop()})),this._state=4)})))},this._scene=e,this._eBook=i,this._position=s,this._shadowGenerator=r,this._highLightLayer=l,this._util=n,this._eBookNode=new o(`eBook-${i.uuid}`,this._scene),this._eBookNode.position=s,this._targetPos=new t(s.x,s.y+.1,s.z),this._eBookNode.rotation.x=-Math.PI/2,a.ImportMesh("",Yt.EBOOK_URL,void 0,this._scene,this._callback)}playOpenBook(){var e;null==(e=this._openBookAnim)||e.play(!1)}playCloseBook(){var e;null==(e=this._closeBookAnim)||e.play(!1)}moveToOriginStepOne(){var e;5==this._state&&(null==(e=this.cameraOutAnim)||e.stop(),this.playCloseBook())}moveToOriginStepTwo(){5==this._state&&(this.cameraInAnim=this._scene.beginDirectAnimation(this._eBookNode,this.createMoveIn(),0,2*Yt.frameRate,!1,void 0,(()=>{this._state=0})),this._state=6)}hoverOut(){var e;0!=this._state&&3!=this._state||(null==(e=this.hoverInAnim)||e.stop(),this.hoverOutAnim=this._scene.beginDirectAnimation(this._eBookNode,this.createHoverOutAnimation(),0,Yt.frameRate,!1,void 0,(()=>{this._state=2})),this._state=1)}hoverIn(){var e;1!=this._state&&2!=this._state||(null==(e=this.hoverOutAnim)||e.stop(),this.hoverInAnim=this._scene.beginDirectAnimation(this._eBookNode,this.createHoverInAnimation(),0,Yt.frameRate,!1,void 0,(()=>{this._state=0})),this._state=3)}createHoverOutAnimation(){let e=new h("hoverOut","position",Yt.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT);const t=[];t.push({frame:0,value:this._eBookNode.position}),t.push({frame:40,value:this._targetPos});let i=new u;return i.setEasingMode(m.EASINGMODE_EASEOUT),e.setEasingFunction(i),e.setKeys(t),[e]}createHoverInAnimation(){let e=new h("hoverIn","position",Yt.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT);const t=[];t.push({frame:0,value:this._eBookNode.position}),t.push({frame:40,value:this._position});let i=new u;return i.setEasingMode(m.EASINGMODE_EASEIN),e.setEasingFunction(i),e.setKeys(t),[e]}createMoveToCamera(){const e=new h("moveAnim","position",Yt.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT),i=[];i.push({frame:0,value:this._eBookNode.position}),i.push({frame:15,value:this._targetPos.add(new t(0,.35,0))}),i.push({frame:60,value:this._util.targetCameraPos()}),i.push({frame:120,value:this._util.targetCameraPos()}),e.setKeys(i);const s=new h("rotateYAnim","rotation.y",Yt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:this._eBookNode.rotation.y}),o.push({frame:60,value:Math.PI/4}),s.setKeys(o);const a=new h("rotateXAnim","rotation.x",Yt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),n=[];return n.push({frame:60,value:this._eBookNode.rotation.x}),n.push({frame:90,value:-Math.PI/2.5}),a.setKeys(n),[s,e]}createMoveIn(){const e=new h("moveAnimReverse","position",Yt.frameRate,h.ANIMATIONTYPE_VECTOR3,h.ANIMATIONLOOPMODE_CONSTANT),i=[];i.push({frame:0,value:this._eBookNode.position}),i.push({frame:40,value:this._eBookNode.position}),i.push({frame:100,value:this._targetPos.add(new t(0,.35,0))}),i.push({frame:120,value:this._position}),e.setKeys(i);const s=new h("rotateXAnimReverse","rotation.x",Yt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:60,value:this._eBookNode.rotation.x}),o.push({frame:90,value:-Math.PI/2}),s.setKeys(o);const a=new h("rotateYAnimReverse","rotation.y",Yt.frameRate,h.ANIMATIONTYPE_FLOAT,h.ANIMATIONLOOPMODE_CONSTANT),n=[];return n.push({frame:60,value:this._eBookNode.rotation.y}),n.push({frame:100,value:0}),a.setKeys(n),[s,a,e]}dispose(){this._eBookNode.dispose(!1,!0)}};let jt=Yt;jt.EBOOK_URL="model/book.glb",jt.frameRate=60;const Jt=class{constructor(e){this._currentEBooks=[],this._EBookLocTransformNodes=[],this._count=new Map,this._computerPowerOn=!1,this._screenMatBlack=null,this._screenMat=null,this.eBookGroupIndex=0,this.updateEBookUp=()=>{console.log("向上翻页");const e=Ut.eBooks;if(this.eBookGroupIndex>0){this.eBookGroupIndex--,this.disposeCurrentBook(),console.log(this.eBookGroupIndex);for(let t=4*this.eBookGroupIndex;t<4*(this.eBookGroupIndex+1)&&t<e.length;t++){const i=e[t];this.placeBook(i,this._EBookLocTransformNodes[t%4])}}},this.updateEBookDown=()=>{console.log("向下翻页");const e=Ut.eBooks;if(!(4*(this.eBookGroupIndex+1)>=e.length)){this.eBookGroupIndex++,this.disposeCurrentBook(),console.log(this.eBookGroupIndex);for(let t=4*this.eBookGroupIndex;t<4*(this.eBookGroupIndex+1)&&t<e.length;t++){const i=e[t];this.placeBook(i,this._EBookLocTransformNodes[t%4])}}},this.updateEBookToFirst=()=>{if(console.log("回到首页"),0==this.eBookGroupIndex)return;this.disposeCurrentBook(),this.eBookGroupIndex=0;const e=Ut.eBooks;console.log(this.eBookGroupIndex);for(let t=4*this.eBookGroupIndex;t<4*(this.eBookGroupIndex+1)&&t<e.length;t++){const i=e[t];this.placeBook(i,this._EBookLocTransformNodes[t%4])}},this._scene=new V(e),this._scene.autoClear=!1;new f("practiceTableHemisphericLight",t.Up(),this._scene).intensity=.7,this._directionalLight=new A("practiceTableLight",new t(1,-2,2),this._scene),this._directionalLight.position.set(0,2,-1),this._directionalLight.intensity=1,this._shadowGenerator=new G(1024,this._directionalLight),this._shadowGenerator.stabilizeCascades=!0,this._shadowGenerator.forceBackFacesOnly=!0,this._shadowGenerator.shadowMaxZ=20,this._shadowGenerator.autoCalcDepthBounds=!0,this._shadowGenerator.lambda=.5,this._shadowGenerator.depthClamp=!0,this._shadowGenerator.penumbraDarkness=.8,this._shadowGenerator.usePercentageCloserFiltering=!0,this._shadowGenerator.filteringQuality=w.QUALITY_HIGH,this._3DGUIManager=new $(this._scene),this._highLightLayer=new x("bookShelfHighLightLayer",this._scene),this.setUpCamera(),this.setUpSound(),this.setUpPracticeTable()}render(){this._scene.render()}setUpCamera(){const i=new e("camera",-(Math.PI/2+Math.PI/4),Math.PI/2,2.8,new t(0,1,0),this._scene);i.attachControl(!0),i.minZ=.1,i.lowerAlphaLimit=-(Math.PI/2+Math.PI/4),i.upperAlphaLimit=-(Math.PI/2+Math.PI/4),i.lowerBetaLimit=Math.PI/2,i.upperBetaLimit=Math.PI/2,i.upperRadiusLimit=2.75,i.lowerRadiusLimit=1.75,i.wheelPrecision=50,this._camera=i}setUpPracticeTable(){a.ImportMesh("",Jt.Practice_Table_URL,void 0,this._scene,((e,t,i,s,o)=>{let a=null;o.forEach((e=>{e.name.startsWith(Jt.EBookLocStartName)&&(this._EBookLocTransformNodes.push(e),this._count.set(e,0)),e.name==Jt.COMPUTER_POWER_LOC&&(a=e)})),e.forEach((e=>{e.receiveShadows=!0,this._shadowGenerator.addShadowCaster(e),e instanceof n&&e.name==Jt.COMPUTER_POWER&&a&&this.setUpComputerPower(e,a),e instanceof n&&e.name==Jt.COMPUTER_SCREEN&&this.setUpComputerScreen(e)}));Ut.eBooks.forEach((e=>{let t=-1;for(let i=0;i<this._EBookLocTransformNodes.length;i++){const e=this._count.get(this._EBookLocTransformNodes[i]);if(!(e>=1)){t=i,this._count.set(this._EBookLocTransformNodes[i],e+1);break}}-1!=t&&this.placeBook(e,this._EBookLocTransformNodes[t])}))}))}placeBook(e,i){const s=new t(-i.position.x,i.position.y,i.position.z),o=new jt(this._scene,e,s,this,this._shadowGenerator,this._highLightLayer);this._currentEBooks.push(o)}disposeCurrentBook(){this._currentEBooks.forEach((e=>e.dispose()))}playClickBookSound(){var e;null==(e=this._clickBookSound)||e.play()}playCloseBookSound(){var e;null==(e=this._closeBookSound)||e.play()}playOpenBookSound(){var e;null==(e=this._openBookSound)||e.play()}targetCameraPos(){let e=new t;e.copyFrom(this._camera.position);const i=this._camera.target.subtract(this._camera.position).normalize();return e.addInPlace(i.multiply(new t(.6,.6,.6))).subtractInPlace(new t(0,.15,0)),e}setUpSound(){this._openBookSound=new g("openBookSound","sound/book/openBook.mp3",this._scene,(()=>{}),{loop:!1,autoplay:!1}),this._closeBookSound=new g("closeBookSound","sound/book/closeBook.mp3",this._scene,(()=>{}),{loop:!1,autoplay:!1}),this._clickBookSound=new g("clickBookSound","sound/book/clickBook.mp3",this._scene,(()=>{}),{loop:!1,autoplay:!1,volume:.2})}setUpComputerPower(e,i){i.position.multiplyInPlace(new t(-1,1,1));const s=new y("powerButtonMat",this._scene);s.diffuseColor=E.Black(),e.material=s;const o=new W(e,"powerOnOff"),a=new z;this._3DGUIManager.addControl(a),a.node.position.copyFrom(i.position),a.node.rotation.y+=Math.PI/1.9,a.addControl(o),o.pointerDownAnimation=()=>{e.scaling.set(.8,.8,.8),this._computerPowerOn=!this._computerPowerOn,this._computerPowerOn?(s.diffuseColor=E.Red(),this._computerScreenTurnOn()):(s.diffuseColor=E.Black(),this._computerScreenTurnOff())},o.pointerUpAnimation=()=>{e.scaling.set(1,1,1)},o.pointerEnterAnimation=()=>{s.diffuseColor=E.Red()},o.pointerOutAnimation=()=>{this._computerPowerOn||(s.diffuseColor=E.Black())}}_computerScreenTurnOn(){this._screenMesh&&this._screenMat&&(this._screenMesh.material=this._screenMat)}_computerScreenTurnOff(){this._screenMesh&&this._screenMatBlack&&(this._screenMesh.material=this._screenMatBlack)}setUpComputerScreen(e){this._screenMesh=e,this._screenMatBlack=e.material;const t=r.CreateForMesh(e,1024,1024,!0,!1);t.uOffset=-.25,t.uScale=1.5,t.getContext();const i=new Y;i.isVertical=!0,i.height="100%",i.width="100%",i.background="#4880D7";const s=new l("main","Java工作室练习台");s.fontSize="60px",s.verticalAlignment=j.VERTICAL_ALIGNMENT_TOP,s.color="white",s.height="100px",s.width="100%",i.addControl(s),t.addControl(i);const o=new Y;o.isVertical=!1,o.verticalAlignment=j.VERTICAL_ALIGNMENT_TOP,o.height="700px",o.width="1000px",i.addControl(o);const a=new Y;a.isVertical=!0,a.verticalAlignment=j.VERTICAL_ALIGNMENT_TOP,a.width="500px";const n=new l("eBook","电子书架");n.height="100px",n.color="white",n.fontSize="50px",a.addControl(n),o.addControl(a);const h=new Y;this._practiceColumn=h,h.isVertical=!0,h.verticalAlignment=j.VERTICAL_ALIGNMENT_TOP,h.width="500px",this.updatePracticeButton(),o.addControl(h),this.addButton("首页",a,this.updateEBookToFirst),this.addButton("上一页",a,this.updateEBookUp),this.addButton("下一页",a,this.updateEBookDown),this._screenMat=e.material,this._computerScreenTurnOff()}updatePracticeButton(){if(this._practiceColumn){this._practiceColumn.children.splice(0,this._practiceColumn.children.length);const e=this._practiceColumn,t=new l("practice","练习");t.height="100px",t.color="white",t.fontSize="50px",e.addControl(t);const i=Ut;Dt.currentPracticeSubTask.forEach((e=>{this.addButton(e.name,this._practiceColumn,(()=>{i.setCurrentPractice(e),i.setPracticeShowing(!0)}))}))}}addButton(e,t,i){const s=J.CreateSimpleButton(e,e);s.width="100%",s.height="100px",s.cornerRadius=25,s.color="white",s.verticalAlignment=j.VERTICAL_ALIGNMENT_TOP,s.background="#f5af19",s.paddingLeft=5,s.paddingRight=5,s.paddingTop=10,s.fontSize="50px",s.onPointerEnterObservable.add((()=>{s.background="#38ef7d"})),s.onPointerOutObservable.add((()=>{s.background="#f5af19"})),s.onPointerDownObservable.add((()=>{i()})),s.onPointerUpObservable.add((()=>{s.background="#f5af19"})),t.addControl(s)}};let Kt=Jt;Kt.COMPUTER_POWER="PracticeTableComputerPower",Kt.COMPUTER_POWER_LOC="PracticeTableComputerPowerLoc",Kt.COMPUTER_SCREEN="PracticeTableComputerScreen",Kt.Practice_Table_URL="model/practiceTable.glb",Kt.EBookLocStartName="Book";const qt={uuid:1,totalFloor:5,name:"北京三维学院",floors:[{floorNumber:1,studios:[{uuid:1,name:"java工作室",location:1,description:"",logoURL:"img/studio/java_logo.png",posterURL:"img/studio/java_poster.png"},{uuid:2,name:"python工作室",location:2,description:"",logoURL:"img/studio/python_logo.png",posterURL:"img/studio/python_poster.png"},{uuid:3,name:"UI设计工作室",location:3,description:"",logoURL:"img/studio/ui_logo.png",posterURL:"img/studio/ui_poster.png"},{uuid:4,name:"大数据工作室",location:4,description:"",logoURL:"img/studio/bigdata_logo.png",posterURL:"img/studio/bigdata_poster.png"},{uuid:5,name:"机器人工作室",location:5,description:"",logoURL:"img/studio/robot_logo.png",posterURL:"img/studio/robot_poster.png"},{uuid:6,name:"人工智能工作室",location:6,description:"",logoURL:"img/studio/AI_logo.png",posterURL:"img/studio/AI_poster.jpg"}]},{floorNumber:2,studios:[{uuid:9,name:"机器人工作室",location:1,description:"",logoURL:"img/studio/robot_logo.png",posterURL:"img/studio/robot_poster.png"},{uuid:10,name:"游戏工作室",location:2,description:"",logoURL:"img/studio/game_logo.png",posterURL:"img/studio/game_poster.png"}]},{floorNumber:3,studios:[{uuid:11,name:"机器人工作室",location:1,description:"",logoURL:"img/studio/robot_logo.png",posterURL:"img/studio/robot_poster.png"},{uuid:12,name:"大数据工作室",location:2,description:"",logoURL:"img/studio/bigdata_logo.png",posterURL:"img/studio/bigdata_poster.png"}]},{floorNumber:4,studios:[{uuid:13,name:"UI设计工作室",location:1,description:"",logoURL:"img/studio/ui_logo.png",posterURL:"img/studio/ui_poster.png"},{uuid:14,name:"大数据工作室",location:2,description:"",logoURL:"img/studio/bigdata_logo.png",posterURL:"img/studio/bigdata_poster.png"}]},{floorNumber:5,studios:[{uuid:15,name:"python工作室",location:1,description:"",logoURL:"img/studio/python_logo.png",posterURL:"img/studio/python_poster.png"},{uuid:16,name:"软件测试工作室",location:2,description:"",logoURL:"img/studio/test_logo.png",posterURL:"img/studio/test_poster.png"}]}]};class Xt extends o{constructor(e,t){super("receptionistRoot",t),e.receptionistMesh.parent=this,this._greetAnimation=e.greetingAnimation,this.setUpAnimation()}setUpAnimation(){this._greetAnimation.loopAnimation=!1,this._greetAnimation.stop()}playGreetingAnimation(){this._greetAnimation.isPlaying||this._greetAnimation.play(!1)}setUpRotateAlongYAxis(e){this.rotation.y=e}}class Zt{constructor(e,t){this._firstGreetingSoundHasPlayed=!1,this._triggeredLessThan=!1,this._triggeredMoreThan=!1,this.keyboardEventHandler=e=>{const t=Pt;switch(e.type){case K.KEYDOWN:switch(e.event.key){case"E":case"e":t.setShowing(!0)}}},this._scene=e,this._receptionistModelURL=t.receptionistModelURL,this._receptionistConfig=t}async loadReceptionist(){let e=await a.ImportMeshAsync("",this._receptionistModelURL,void 0,this._scene),t=e.meshes,i=e.animationGroups,s={receptionistMesh:t[0],greetingAnimation:i[0]};this.receptionist=new Xt(s,this._scene),this.setUpSound(),this.setUpReceptionistUI()}set receptionistPosition(e){this.receptionist.position.set(-e.x,e.y,e.z)}get receptionistPosition(){return this.receptionist.position}triggerOnceWhenDistanceLessThan(e,t,i){this._scene.registerBeforeRender((()=>{const s=t.playerPosition.subtract(this.receptionistPosition).length();!this._triggeredLessThan&&s<e&&(this._triggeredLessThan=!0,this.keyBoardObserver||(this.keyBoardObserver=this._scene.onKeyboardObservable.add(this.keyboardEventHandler)),i())})),this._scene.registerAfterRender((()=>{t.playerPosition.subtract(this.receptionistPosition).length()>e&&(this._triggeredLessThan=!1,this.keyBoardObserver&&(this._scene.onKeyboardObservable.remove(this.keyBoardObserver),this.keyBoardObserver=null))}))}triggerOnceWhenDistanceMoreThan(e,t,i){this._scene.registerBeforeRender((()=>{const s=t.playerPosition.subtract(this.receptionistPosition).length();!this._triggeredMoreThan&&s>e&&(this._triggeredMoreThan=!0,i())})),this._scene.registerAfterRender((()=>{t.playerPosition.subtract(this.receptionistPosition).length()<e&&(this._triggeredMoreThan=!1)}))}triggerWhenDistanceLessThan(e,t,i){this._scene.registerBeforeRender((()=>{t.playerPosition.subtract(this.receptionistPosition).length()<e&&i()}))}setUpReceptionistUI(){const e=r.CreateFullscreenUI("ReceptionistUI",!0),t=new l;t.text="按E键打开任务面板";const i=new b;i.width="200px",i.height="40px",i.cornerRadius=20,i.color="black",i.thickness=3,i.fontFamily="Microsoft Yahei",i.background="white",i.addControl(t),e.addControl(i),i.linkWithMesh(this.receptionist),i.linkOffsetY=-180}setUpSound(){this._firstGreetingSound=new g("greetingSound",this._receptionistConfig.greetingSoundURL,this._scene,null,{autoplay:!1,loop:!1}),this._introductionSound=new g("introductionSound",this._receptionistConfig.introductionSoundURL,this._scene,null,{autoplay:!1,loop:!1}),this._videoHintSound=new g("videoHintSound","sound/taskHint/videoHint.mp3",this._scene,null,{autoplay:!1,loop:!1}),this._exerciseHintSound=new g("exerciseHintSound","sound/taskHint/exerciseHint.mp3",this._scene,null,{autoplay:!1,loop:!1}),this._readingHintSound=new g("readingHintSound","sound/taskHint/readingHint.mp3",this._scene,null,{autoplay:!1,loop:!1}),this._taskFinishedHintSound=new g("taskFinishedHintSound","sound/taskHint/taskFinishedHint.mp3",this._scene,null,{autoplay:!1,loop:!1})}playVideoHintSound(){var e;null==(e=this._videoHintSound)||e.play()}playReadingHintSound(){var e;null==(e=this._readingHintSound)||e.play()}playExerciseHintSound(){var e;null==(e=this._exerciseHintSound)||e.play()}playTaskFinishedHintSound(){var e;null==(e=this._taskFinishedHintSound)||e.play()}playGreeting(){var e,t;this._firstGreetingSound&&!this._firstGreetingSound.isPlaying&&(this._firstGreetingSoundHasPlayed?(null==(e=this._introductionSound)?void 0:e.isPlaying)||null==(t=this._introductionSound)||t.play():(this._firstGreetingSoundHasPlayed=!0,this._firstGreetingSound.play())),this.receptionist.playGreetingAnimation()}}const Qt=new class{constructor(){this.isShowingDescription=!1,this.description={avatarURL:"",title:"",position:"",info:""},I(this)}setDescription(e){this.description=e}setDescriptionShow(e){this.isShowingDescription=e}};class ei{constructor(e,t,i){this._triggeredMoreThan=!1,this._triggeredLessThan=!1,this._scene=e,this._mesh=t,this._player=i}triggerOnceWhenDistanceLessThan(e,i){this._scene.registerBeforeRender((()=>{const s=this._player.playerPosition.subtract(this._mesh.position.multiply(new t(-1,1,1))).length();!this._triggeredLessThan&&s<e&&(this._triggeredLessThan=!0,i())})),this._scene.registerAfterRender((()=>{this._player.playerPosition.subtract(this._mesh.position.multiply(new t(-1,1,1))).length()>e&&(this._triggeredLessThan=!1)}))}triggerOnceWhenDistanceMoreThan(e,i){this._scene.registerBeforeRender((()=>{const s=this._player.playerPosition.subtract(this._mesh.position.multiply(new t(-1,1,1))).length();!this._triggeredMoreThan&&s>e&&(this._triggeredMoreThan=!0,i())})),this._scene.registerAfterRender((()=>{this._player.playerPosition.subtract(this._mesh.position.multiply(new t(-1,1,1))).length()<e&&(this._triggeredMoreThan=!1)}))}triggerWhenDistanceLessThan(e,i){this._scene.registerBeforeRender((()=>{const s=this._player.playerPosition.subtract(this._mesh.position.multiply(new t(-1,1,1))).length();s<e&&i(s)}))}}const ti=new class{constructor(){this.isShowingDialog=!1,this.count=0,this.dialog={avatarURL:"",position:"",title:"",info:""},I(this,{count:!1})}setDialogInfo(e){0==this.count&&(this.dialog=e)}setDialogShowing(e){e&&!this.count&&(this.isShowingDialog=e,this.count++),e||(this.isShowingDialog=e,this.count--)}};var ii,si;(si=ii||(ii={}))[si.wait=0]="wait",si[si.waitFinished=1]="waitFinished",si[si.moving=2]="moving",si[si.closeToPlayer=3]="closeToPlayer";class oi{constructor(e,i,s,n){this._path=[],this._infoSound=[],this.modelLoaded=(e,i,s,o,a,n,r)=>{const l=e[0];let h=L.CreateBox(`AI-${this._aiInfo.name}-CollisionBox`,{width:ft.PlayerCollisionBoxWidth,height:ft.PlayerCollisionBoxHeight,depth:ft.PlayerCollisionBoxDepth});h.bakeTransformIntoVertices(B.Translation(0,ft.PlayerCollisionBoxHeight/2,0)),h.isVisible=!1,h.isPickable=!1,h.checkCollisions=!0,h.ellipsoid=new t(ft.PlayerCollisionBoxWidth/2,ft.PlayerCollisionBoxHeight/2,ft.PlayerCollisionBoxDepth/2),h.ellipsoidOffset=new t(0,ft.PlayerCollisionBoxHeight/2,0),h.rotationQuaternion=new k(0,0,0,0),l.parent=h,h.parent=this._aiTransformNode,this.idleAnimation=o.find((e=>e.name==this._aiInfo.idleAnimationGroupName)),this.idleAnimation.loopAnimation=!0,this.idleAnimation.stop(),this.walkAnimation=o.find((e=>e.name==this._aiInfo.walkAnimationGroupName)),this.walkAnimation.loopAnimation=!0,this.walkAnimation.stop(),this.leftTurnAnimation=o.find((e=>e.name==this._aiInfo.leftTurnAnimationGroupName)),this.leftTurnAnimation.loopAnimation=!1,this.leftTurnAnimation.stop(),this.rightTurnAnimation=o.find((e=>e.name==this._aiInfo.rightTurnAnimationGroupName)),this.rightTurnAnimation.loopAnimation=!1,this.rightTurnAnimation.stop(),this.idleAnimation.play(),this.setUpPath()},this._currentIndex=0,this._state=1,this._prevState=0,this._encounterPlayer=!1,this._trigger=!1,this._scene=e,this._aiInfo=i,this._navigationPlugin=n,this._aiCrowd=s,this.findPath();let r=this._path[0].desPos;this._aiTransformNode=new o(`AI-${this._aiInfo.name}`,this._scene),this._aiIndex=s.addAgent(r,{radius:.2,height:.2,maxAcceleration:1,maxSpeed:.5,collisionQueryRange:.5,pathOptimizationRange:0,separationWeight:1},this._aiTransformNode),this.setUpSound(),a.ImportMesh("",this._aiInfo.modelURL,void 0,this._scene,this.modelLoaded)}setUpPath(){this._scene.registerBeforeRender((()=>{if(this._encounterPlayer){if(this._playerManager){const e=this._aiCrowd.getAgentPosition(this._aiIndex);this._aiCrowd.agentGoto(this._aiIndex,e),this.walkAnimation.stop(),this.idleAnimation.play();const t=this._aiTransformNode.position.subtract(this._playerManager.playerPosition).normalize().scale(-1);let i=Math.atan2(t.x,t.z);Math.abs(i-this._aiTransformNode.rotation.y)>=Math.PI?i>this._aiTransformNode.rotation.y?this._aiTransformNode.rotation.y=this._aiTransformNode.rotation.y+.025*(2*Math.PI+this._aiTransformNode.rotation.y-i):this._aiTransformNode.rotation.y=this._aiTransformNode.rotation.y+.025*(2*Math.PI+i-this._aiTransformNode.rotation.y):this._aiTransformNode.rotation.y=this._aiTransformNode.rotation.y+.025*(i-this._aiTransformNode.rotation.y)}}else{let e=this._aiCrowd.getAgentVelocity(this._aiIndex);if(e.length()>.4){let t=Math.atan2(e.x,e.z);Math.abs(t-this._aiTransformNode.rotation.y)>=Math.PI?t>this._aiTransformNode.rotation.y?this._aiTransformNode.rotation.y=this._aiTransformNode.rotation.y+.025*(2*Math.PI+this._aiTransformNode.rotation.y-t):this._aiTransformNode.rotation.y=this._aiTransformNode.rotation.y+.025*(2*Math.PI+t-this._aiTransformNode.rotation.y):this._aiTransformNode.rotation.y=this._aiTransformNode.rotation.y+.025*(t-this._aiTransformNode.rotation.y)}if(0==this._state);else if(1==this._state){let e=(this._currentIndex+1)%this._path.length;const t=this._path[e];this._aiCrowd.agentGoto(this._aiIndex,t.desPos),this._state=2,this.idleAnimation.stop(),this.walkAnimation.play(!0)}else if(2==this._state){let e=(this._currentIndex+1)%this._path.length;const t=this._path[e];this._aiCrowd.getAgentPosition(this._aiIndex).subtract(t.desPos).length()<.05&&(this._state=0,this.walkAnimation.stop(),this.idleAnimation.play(!0),this._currentIndex++,q({timeout:t.residenceTime,contextObservable:this._scene.onBeforeRenderObservable,onEnded:()=>{this._state=1}}))}}}))}findPath(){this._aiInfo.path.forEach((e=>{const i=this._scene.getTransformNodeByName(e.nodeName);if(i){let s=this._navigationPlugin.getClosestPoint(new t(-1*i.position.x,i.position.y,i.position.z));s=this._navigationPlugin.getClosestPoint(s),this._path.push({desPos:s,residenceTime:e.residenceTime})}}))}setUpWithPlayer(e){this._playerManager=e,this._scene.registerBeforeRender((()=>{if(e.playerPosition.subtract(this._aiTransformNode.position).length()<1.5)this._trigger||(this.randomDialog(),this._prevState=this._state,this._encounterPlayer=!0,this._trigger=!0);else{if(this._encounterPlayer){if(console.log("状态变回",this._prevState),this._state=this._prevState,2==this._state||0==this._state){let e=(this._currentIndex+1)%this._path.length;const t=this._path[e];this._aiCrowd.agentGoto(this._aiIndex,t.desPos),this._state=2,this.idleAnimation.stop(),this.walkAnimation.play(!0)}ti.setDialogShowing(!1)}this._encounterPlayer=!1,this._trigger=!1}}))}randomDialog(){console.log("触发");const e=Math.floor(Math.random()*this._aiInfo.info.length);let t={avatarURL:this._aiInfo.avatarURL,info:this._aiInfo.info[e],position:this._aiInfo.position,title:this._aiInfo.title};const i=ti;0==i.count&&(this._infoSound.forEach((e=>e.stop())),this._infoSound[e].play()),i.setDialogInfo(t),i.setDialogShowing(!0)}setUpSound(){this._aiInfo.infoSoundURL.forEach(((e,t)=>{this._infoSound.push(new g(`${this._aiInfo.name}-sound-${t}`,e,this._scene,(()=>{}),{loop:!1,autoplay:!1}))}))}}class ai{constructor(e,t,i){this._bookShelfMesh=[],this._practiceTableMesh=[],this._navigationPlugin=new X(new Z),this._AIs=[],this._highlightBookShelf=!1,this._highlightPracticeTable=!1,this._currentArea=null,this._bookShelfAreaHint=!0,this._practiceTableAreaHint=!0,this.keyboardEventHandler=e=>{switch(e.type){case K.KEYDOWN:switch(e.event.key){case"E":case"e":"BookShelf"==this._currentArea?this._web3DStudio.setBookShelfShow(!0):"PracticeTable"==this._currentArea&&this._web3DStudio.setPracticeTableShow(!0)}}},this._scene=e,this._studio=t,this._web3DStudio=i,this._scene.collisionsEnabled=!0;Dt.setStudioManager(this)}async load(){this.setUpLight(),this.setUpCamera(),await this.loadModel(),this.setUpShadow(),await this.setUpPlayer(),await this.setUpReceptionist(),this.setUpRotateCamera(),this.setUpSound(),this.setUpBookShelf(),this.setUpPracticeTable()}setUpLight(){new f("hemisphericLight",t.Up(),this._scene).intensity=.5,this._directionalLight=new A("directionalLight",new t(1,-2,1),this._scene),this._directionalLight.position=this._studio.directionalLightPosition}setUpCamera(){this._scene.createDefaultCamera()}async loadModel(){let e=await a.ImportMeshAsync("",this._studio.modelURL,void 0,this._scene),t=e.transformNodes,i=e.meshes;this._playerSpawn=t.find((e=>e.name==this._studio.playerSpawn)),this._receptionistSpawn=t.find((e=>e.name==this._studio.receptionistConfig.receptionistSpawn)),i.forEach((e=>{e instanceof n&&(e.name.startsWith(this._studio.bookShelfStartName)?this._bookShelfMesh.push(e):e.name.startsWith(this._studio.practiceTableStartName)&&this._practiceTableMesh.push(e))})),this.setUpCollisionBox(i)}setUpCollisionBox(e){let t=[];e.forEach((e=>{this._studio.collisionBox.find((t=>t==e.name))&&(e.isVisible=!1,e.checkCollisions=!0,e instanceof n&&t.push(e))}));let i=e.find((e=>e.name==this._studio.groundName));i&&(i.isVisible=!0,i instanceof n&&t.push(i)),this.setUpNavMesh(t)}async setUpPlayer(){this._playerManager=new ft(this._scene,this._studio.playerModelURL),await this._playerManager.loadPlayer(),this._playerSpawn?this._playerManager.playerPosition=this._playerSpawn.position:console.log("没有设置玩家的起始位置"),this._AIs.forEach((e=>{e.setUpWithPlayer(this._playerManager)}))}setUpShadow(){const e=new w(1024,this._directionalLight);e.usePercentageCloserFiltering=!0,e.filteringQuality=w.QUALITY_HIGH,e.getShadowMap().refreshRate=Q.REFRESHRATE_RENDER_ONCE,this._scene.meshes.forEach((t=>{t.name!=this._studio.groundName&&e.addShadowCaster(t,!1)}));let t=this._scene.getMeshByName(this._studio.groundName);t&&(t.receiveShadows=!0)}setUpRotateCamera(){this._playerManager.setUpRotateCamera(this._studio.rotateCamera)}async setUpReceptionist(){this._receptionManager=new Zt(this._scene,this._studio.receptionistConfig),Dt.setReceptionistManager(this._receptionManager),await this._receptionManager.loadReceptionist(),this._receptionistSpawn&&(this._receptionManager.receptionistPosition=this._receptionistSpawn.position),this._receptionManager.receptionist.setUpRotateAlongYAxis(this._studio.receptionistConfig.receptionistRotateYAxis),r.CreateFullscreenUI("");const e=Qt;e.setDescription({avatarURL:"img/avatar/javaReceptionistAvatar.png",info:"Hi~，欢迎来到北京三维学院Java工作室，我是你的培训师姐，我叫李丹",position:"Java架构高级工程师",title:"高级工程师"}),this._receptionManager.triggerOnceWhenDistanceLessThan(this._studio.receptionistConfig.distanceTrigger,this._playerManager,(()=>{this._receptionManager.playGreeting(),e.setDescriptionShow(!0)})),this._receptionManager.triggerOnceWhenDistanceMoreThan(this._studio.receptionistConfig.distanceTrigger,this._playerManager,(()=>{e.setDescriptionShow(!1)})),this._scene.registerBeforeRender((()=>{this._receptionManager.receptionist.lookAt(this._playerManager.playerPosition)}))}setHighLightBookShelf(e){this._highlightBookShelf=e}setHighlightPracticeTable(e){this._highlightPracticeTable=e}turnOffAllHighLight(){this._highlightBookShelf=!1,this._highlightPracticeTable=!1}setUpBookShelf(){this._bookShelfMesh.forEach((e=>{e.renderOutline=!1;const t=E.FromHexString("#1FA2FF"),i=E.FromHexString("#A6FFCB");e.outlineColor=t,e.outlineWidth=3;let s=!0,o=!1;this._scene.registerBeforeRender((()=>{this._highlightBookShelf?(e.renderOutline=!0,s&&(e.outlineWidth+=.05,e.outlineColor=E.Lerp(e.outlineColor,i,.02),e.outlineWidth>5&&(s=!1,o=!0)),o&&(e.outlineColor=E.Lerp(e.outlineColor,t,.02),e.outlineWidth-=.05,e.outlineWidth<3&&(s=!0,o=!1))):e.renderOutline=!1}));const a=Dt,n=new ei(this._scene,e,this._playerManager);n.triggerOnceWhenDistanceLessThan(1.5,(()=>{this._currentArea="BookShelf",this._bookShelfAreaHint&&(a.setDialogShowing(!0),this._sound.bookShelf.isPlaying||this._sound.bookShelf.play(),a.setDialogInfo({avatarURL:this._studio.playerAvatarURL,title:"视频图书架",info:"这里是Java工作室的电子视频图书架,按E键可以打开书架"}),this._bookShelfAreaHint=!1),this.keyBoardObserver||(this.keyBoardObserver=this._scene.onKeyboardObservable.add(this.keyboardEventHandler))})),n.triggerOnceWhenDistanceMoreThan(1.5,(()=>{this._currentArea=null,a.setDialogShowing(!1),this.keyBoardObserver&&(this._scene.onKeyboardObservable.remove(this.keyBoardObserver),this.keyBoardObserver=null)}))}))}setUpSound(){const e=new g("","sound/java/bookShelf.mp3",this._scene,(()=>{}),{loop:!1,autoplay:!1}),t=new g("","sound/java/practiceTable.mp3",this._scene,(()=>{}),{loop:!1,autoplay:!1});this._sound={bookShelf:e,practiceTable:t}}setUpPracticeTable(){this._practiceTableMesh.forEach((e=>{e.renderOutline=!1;const t=E.FromHexString("#1FA2FF"),i=E.FromHexString("#A6FFCB");e.outlineColor=t,e.outlineWidth=3;let s=!0,o=!1;this._scene.registerBeforeRender((()=>{this._highlightPracticeTable?(e.renderOutline=!0,s&&(e.outlineWidth+=.05,e.outlineColor=E.Lerp(e.outlineColor,i,.02),e.outlineWidth>5&&(s=!1,o=!0)),o&&(e.outlineColor=E.Lerp(e.outlineColor,t,.02),e.outlineWidth-=.05,e.outlineWidth<3&&(s=!0,o=!1))):e.renderOutline=!1}));const a=Dt,n=new ei(this._scene,e,this._playerManager);n.triggerOnceWhenDistanceLessThan(1.5,(()=>{this._currentArea="PracticeTable",this._practiceTableAreaHint&&(a.setDialogShowing(!0),this._sound.practiceTable.isPlaying||this._sound.practiceTable.play(),a.setDialogInfo({avatarURL:this._studio.playerAvatarURL,title:"课后练习台",info:"这里是Java工作室的课后练习台,按E键可以打开练习台"}),this._practiceTableAreaHint=!1),this.keyBoardObserver||(this.keyBoardObserver=this._scene.onKeyboardObservable.add(this.keyboardEventHandler))})),n.triggerOnceWhenDistanceMoreThan(1.5,(()=>{this._currentArea=null,a.setDialogShowing(!1),this.keyBoardObserver&&(this._scene.onKeyboardObservable.remove(this.keyBoardObserver),this.keyBoardObserver=null)}))}))}setUpNavMesh(e){const t=this._navigationPlugin;t.createNavMesh(e,{cs:.2,ch:.01,walkableSlopeAngle:10,walkableHeight:1,walkableClimb:0,walkableRadius:1,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1});const i=t.createCrowd(this._studio.studioAIs.length,.5,this._scene);this._studio.studioAIs.forEach((e=>{console.log("创建AI");const s=new oi(this._scene,e,i,t);this._AIs.push(s)}))}}ai.PlayerModelUrl="model/receptionist.glb",ai.PlayerCollisionBoxWidth=.7,ai.PlayerCollisionBoxHeight=1.8,ai.PlayerCollisionBoxDepth=.5;const ni={name:"java工作室",modelURL:"model/studio/java_studio.glb",playerModelURL:"model/player.glb",description:"java工作室 一个学习高并发的工作室",playerSpawn:"playerSpawn",collisionBox:["collision","ground"],groundName:"ground",playerAvatarURL:"img/avatar/playerAvatar.png",directionalLightPosition:new t(-10,10,-10),bookShelfStartName:"BookShelf",practiceTableStartName:"PracticeTable",receptionistConfig:{receptionistModelURL:"model/receptionist.glb",receptionistSpawn:"receptionistSpawn",receptionistRotateYAxis:Math.PI/2,distanceTrigger:2,greetingSoundURL:"sound/javaGreeting.mp3",introductionSoundURL:"sound/javaIntroduction.mp3"},rotateCamera:[{mesh:"cameraRotate_1",rotate:0},{mesh:"cameraRotate_2",rotate:-Math.PI/2},{mesh:"cameraRotate_3",rotate:Math.PI/2},{mesh:"cameraRotate_4",rotate:0},{mesh:"cameraRotate_5",rotate:Math.PI}],studioAIs:[{name:"黄奥",info:["同学，你今天Java学习的怎么样了","JDK是JAVA的开发工具包"],infoSoundURL:["sound/java/ai/Java学习的怎么样了.mp3","sound/java/ai/JDK是JAVA的开发工具包.mp3"],title:"Java高级工程师",position:"Java高级工程师",modelURL:"model/ai/ai_1.glb",idleAnimationGroupName:"Idle",walkAnimationGroupName:"Walk",leftTurnAnimationGroupName:"LeftTurn",rightTurnAnimationGroupName:"RightTurn",avatarURL:"img/avatar/ai_1.png",path:[{nodeName:"aiPath-1.001",residenceTime:4e3},{nodeName:"aiPath-1.002",residenceTime:4e3},{nodeName:"aiPath-1.003",residenceTime:6e3},{nodeName:"aiPath-1.004",residenceTime:4e3}]},{name:"余少",info:["你还记得jvm有多少种垃圾收集器吗","你还记得字节码是什么吗"],infoSoundURL:["sound/java/ai/jvm有多少种垃圾收集器.mp3","sound/java/ai/字节码是什么.mp3"],title:"Java高级工程师",position:"Java高级工程师",modelURL:"model/ai/ai_2.glb",idleAnimationGroupName:"Idle",walkAnimationGroupName:"Walk",leftTurnAnimationGroupName:"LeftTurn",rightTurnAnimationGroupName:"RightTurn",avatarURL:"img/avatar/ai_2.png",path:[{nodeName:"aiPath-2.001",residenceTime:5e3},{nodeName:"aiPath-2.002",residenceTime:4e3},{nodeName:"aiPath-2.003",residenceTime:3e3},{nodeName:"aiPath-2.004",residenceTime:6e3}]},{name:"黄笨蛋",info:["for循环的lambda形式是什么呢","生产者消费者问题"],infoSoundURL:["sound/java/ai/for循环的lambda形式是什么呢.mp3","sound/java/ai/生产者消费者问题.mp3"],title:"Java高级工程师",position:"Java高级工程师",modelURL:"model/ai/ai_3.glb",idleAnimationGroupName:"Idle",walkAnimationGroupName:"Walk",leftTurnAnimationGroupName:"LeftTurn",rightTurnAnimationGroupName:"RightTurn",avatarURL:"img/avatar/ai_3.png",path:[{nodeName:"aiPath-3.001",residenceTime:5e3},{nodeName:"aiPath-3.002",residenceTime:4e3},{nodeName:"aiPath-3.003",residenceTime:5e3},{nodeName:"aiPath-3.004",residenceTime:2e3}]}]};var ri,li;(li=ri||(ri={}))[li.init=0]="init",li[li.chooseCollege=1]="chooseCollege",li[li.chooseStudio=2]="chooseStudio",li[li.studio=3]="studio";class hi{constructor(e){this._bookShelfShowing=!1,this._practiceTableShowing=!1,this._state=0,this._bookShelf=null,this._practiceTable=null,a.ShowLoadingScreen=!1,this._canvas=e,this._engine=new ee(this._canvas,!0,{stencil:!0}),this._scene=new V(this._engine),this.loadingScene=new Ze(this._scene),this.setBookShelfScene(),this.setPracticeTableScene(),this.setDebugUI(),this.run(),this.setLoadingAnimation()}setDebugUI(){window.addEventListener("keydown",(e=>{e.ctrlKey&&73===e.keyCode&&(this._scene.debugLayer.isVisible()?this._scene.debugLayer.hide():(console.log("打开debug tab"),this._scene.debugLayer.show()))}))}run(){this._engine.runRenderLoop((()=>{if(this._scene.render(),this._bookShelfShowing&&(null==this._bookShelf?(this._bookShelf=new Wt(this._engine),this._bookShelf.render()):this._bookShelf.render()),this._practiceTableShowing)if(null==this._practiceTable){this._practiceTable=new Kt(this._engine);Ut.practiceTable=this._practiceTable,this._practiceTable.render()}else this._practiceTable.render()})),window.addEventListener("resize",(e=>{this._engine.resize()}))}async setLoadingAnimation(){await this.goToCollegeMap()}async goToCollegeMap(){let e=new V(this._engine);let t=new ht(e,this,at);await t.load(),this._scene=e}async goToCollege(e){const t=this._scene;this.changeToLoadingScene();let i=new V(this._engine),s=new kt(i,this,qt);await s.load(),this._scene=i,t.dispose()}changeToLoadingScene(){this._scene=this.loadingScene.scene}async goToStudio(e){const t=mt;t.setFloorUiShowing(!1),t.setVisitStudioUiShowing(!1),t.setEveryFloorUiShowing(!1),t.setVisitUiShowing(!1);const i=this._scene;this.changeToLoadingScene();let s=new V(this._engine),o=new ai(s,ni,this);await o.load(),i.dispose(),this._scene=s}setBookShelfScene(){Et.web3DStudio=this}setBookShelfShow(e){if(this._bookShelfShowing=e,this._bookShelfShowing){Et.setShelfShowing(!0)}}setPracticeTableShow(e){if(this._practiceTableShowing=e,this._practiceTableShowing){Ut.setPracticeTableShowing(!0)}}setPracticeTableScene(){Ut.web3DStudio=this}}var ci="_logo_1lphs_1",ui="_none_1lphs_13",mi="_collegeUI_1lphs_21",di="_cardImg_1lphs_63";const _i=te((e=>{const t=e.uiState.college;let i;return i=t?ie.createElement(ie.Fragment,null,ie.createElement("img",{src:t.imgUrl,className:di}),ie.createElement(se,null,ie.createElement(se.Title,{level:3},t.name),ie.createElement(se.Text,null,ie.createElement(se.Text,{strong:!0},"学院介绍:  "),t.description),ie.createElement(oe,{type:"horizontal"}),ie.createElement(se.Title,{level:3},"工作室"),ie.createElement(ae,{dataSource:t.studios,renderItem:e=>ie.createElement(ae.Item,null,ie.createElement("img",{src:e.logoUrl,className:ci}),e.name)}))):ie.createElement(ie.Fragment,null,ie.createElement("h1",null,"无内容")),ie.createElement(ne,{className:`${mi} ${e.uiState.isShowing?"":ui}`},i)}));var pi="_right_1y9fq_1",gi="_content_1y9fq_11",fi="_image_1y9fq_19",Ai="_bg_1y9fq_33",wi="_unSkew_1y9fq_63",vi="_none_1y9fq_71";const Ti=te((e=>{const t=e.receptionistUiState;return ie.createElement(ie.Fragment,null,ie.createElement("div",{className:`${Ai} ${t.isShowingDescription?"":vi}`},ie.createElement("div",{className:`${gi} ${wi}`},ie.createElement("img",{src:t.description.avatarURL,alt:"",className:fi}),ie.createElement("h2",{className:pi},"职务：",t.description.position," 岗位：",t.description.title),ie.createElement("h1",{style:{textAlign:"center"}},t.description.info))))}));var ki="_card_7ol8v_1",yi="_none_7ol8v_7",Ei="_closeButton_7ol8v_15",bi="_tab_7ol8v_27",Ni="_taskTab_7ol8v_35",Si="_main_7ol8v_57";function Mi(e){const t=e.task;t.subTask.filter((e=>e.status==bt.Finished)).length;t.subTask.length;const[i,s]=ie.useState(!1),o=()=>{s(!0)},a=()=>{s(!1)},n=()=>{s(!1)},r=()=>{Pt.acceptTask(t.uuid),H.success({message:"接收到新的任务",description:`任务名称:${t.name} `,placement:"topLeft"}),s(!1)};return ie.createElement(ie.Fragment,null,ie.createElement(ne,{className:ki,title:ie.createElement("h3",{style:{textAlign:"left"}},t.name)},ie.createElement(ge,{align:"middle"},ie.createElement(fe,{span:2},ie.createElement(Ae,{style:{fontSize:"40px"}})),ie.createElement(fe,{span:18},ie.createElement(ge,null,ie.createElement("h1",null,t.description)),ie.createElement(ge,null,ie.createElement("h1",{style:{color:"#40A9FF"}},"学习目的:")," ",ie.createElement("h1",null," ",t.goal))),ie.createElement(fe,{span:4},e.finished?ie.createElement(ie.Fragment,null,ie.createElement(ge,{style:{paddingBottom:"10px"}},ie.createElement(Te,{value:t.rate,disabled:!0})),ie.createElement(ge,null,ie.createElement(de,{type:"primary",danger:!0,onClick:()=>o()},"查看详细评分"))):ie.createElement(de,{type:"primary",onClick:()=>o()},"查看详情")))),(()=>{if(e.finished){const e=t.subTask.map((e=>ie.createElement(we.Item,{color:"green",label:e.name},ie.createElement(ve,{title:`${e.name} 评价等级为 ${e.rate}`},e.description," ",ie.createElement(Te,{allowHalf:!0,disabled:!0,value:e.rate})))));return ie.createElement(ie.Fragment,null,ie.createElement(ke,{centered:!0,visible:i,title:t.name,onOk:a,onCancel:n,cancelText:"返回",okText:"确认"},ie.createElement(se,null,ie.createElement(me,{level:3},"任务介绍"),ie.createElement(ye,null,t.description),ie.createElement(me,{level:3},"任务最终目的"),ie.createElement(ye,null,t.goal),ie.createElement(oe,null),ie.createElement(me,{level:3},"包含的子任务")),ie.createElement("br",null),ie.createElement(we,{mode:"left"},e),ie.createElement(oe,null),ie.createElement(se,null,ie.createElement(me,{level:3},"总评分等级:")),ie.createElement(ve,{title:`${t.name} 最终评分为 ${t.rate}`},ie.createElement("div",{style:{margin:"0 auto",textAlign:"center"}},ie.createElement(Te,{value:t.rate,allowHalf:!0,disabled:!0})))))}{const e=t.subTask.map((e=>ie.createElement(we.Item,{label:e.name},e.description)));return ie.createElement(ie.Fragment,null,ie.createElement(ke,{centered:!0,visible:i,title:t.name,onOk:r,onCancel:n,cancelText:"取消",okText:"接受任务"},ie.createElement(se,null,ie.createElement(me,{level:3},"任务介绍"),ie.createElement(ye,null,t.description),ie.createElement(me,{level:3},"任务最终目的"),ie.createElement(ye,null,t.goal),ie.createElement(oe,null),ie.createElement(me,{level:3},"包含的子任务")),ie.createElement("br",null),ie.createElement(we,{mode:"left"},e)))}})())}const Ri=te((e=>{const t=e.taskUiState,[i,s]=ie.useState("unfinished");return ie.createElement(ie.Fragment,null,ie.createElement("div",{className:`${Si} ${t.isShowing?"":yi}`},ie.createElement("div",{className:Ni},ie.createElement(re,{className:bi},ie.createElement(le,{theme:"light",collapsed:!1},ie.createElement("div",{className:"logo"},ie.createElement(he,{style:{fontSize:"50px",margin:"0 0 0  30px",paddingTop:"7px",paddingBottom:"7px"}})),ie.createElement(ce,{mode:"inline",defaultSelectedKeys:["unfinished"],onClick:e=>s(e.key.toString())},ie.createElement(ce.Item,{key:"unfinished"},"未完成"),ie.createElement(ce.Item,{key:"finished"},"已完成"))),ie.createElement(re,null,ie.createElement(ue,{style:{padding:0,background:"white"}},ie.createElement(se,null,ie.createElement(me,{level:2,style:{textAlign:"center",lineHeight:"64px"}},"任务中心")),ie.createElement(de,{className:Ei,icon:ie.createElement(_e,null),type:"primary",onClick:()=>{t.setShowing(!1)}})),ie.createElement(pe,{style:{margin:"24px 16px",padding:24,overflow:"auto"}},"unfinished"==i?t.unAcceptTask.map((e=>ie.createElement(Mi,{key:e.uuid,task:e,finished:!1}))):t.finishedTask.map((e=>ie.createElement(Mi,{key:e.uuid,task:e,finished:!0})))))))))}));class Ii{constructor(e,s,o){this._started=!1,this._exploded=!1,this.flareImageURL="img/flare.png",this._scene=e,this._rocketSound=new g("rocketSound","sound/firework/rocket.wav",this._scene,(()=>{})),this._explosionSound=new g("rocketSound","sound/firework/explosion.wav",this._scene,(()=>{}));const a=L.CreateSphere("rocket",{segments:4,diameter:1});this._emitter=a,a.isVisible=!1,this._emitter.position.copyFrom(s.position),this._height=o;let n=new Ee(`${s.name}-particleSystem`,100,e);n.particleTexture=new R(this.flareImageURL,e),n.emitter=a,n.minEmitBox=new t(0,0,0),n.maxEmitBox=new t(0,0,0),n.color1=new i(1,.8,1,1),n.color2=new i(1,.5,1,1),n.colorDead=new i(0,0,.2,.5),n.minSize=.7,n.maxSize=.7,n.addSizeGradient(0,1),n.addSizeGradient(1,.1),n.minLifeTime=1,n.maxLifeTime=1,n.emitRate=40,n.minEmitPower=1,n.maxEmitPower=1,n.updateSpeed=.02,n.blendMode=Ee.BLENDMODE_ONEONE,this._particleSys=n}launchFireWork(){this._started?this._emitter.position.y>=this._height?this._exploded||(this._explosionSound.play(),this._exploded=!0,this.explosion(this._emitter.position),this._emitter.dispose(),this._particleSys.stop()):this._emitter.position.y+=.05:(this._started=!0,this._particleSys.start(),this._rocketSound.play())}explosion(e){const s=n.CreateSphere("explosion",4,.5,this._scene);s.isVisible=!1,s.position=e;let o=s;o.useVertexColors=!0;let a=o.getVerticesData(be.PositionKind),r=o.getVerticesData(be.NormalKind),l=[];for(let h=0;h<a.length;h+=3){let e=new t(a[h],a[h+1],a[h+2]),s=new t(r[h],r[h+1],r[h+2]),c=Math.random(),u=Math.random(),m=Math.random(),d=1,_=new i(c,u,m,d);l.push(c),l.push(u),l.push(m),l.push(d);let p=n.CreateBox("gizmo",.001,this._scene);p.position=e,p.parent=o;let g=s.normalize().scale(1);const f=new Ee("particles",20,this._scene);f.particleTexture=new R(this.flareImageURL,this._scene),f.emitter=p,f.minEmitBox=new t(1,0,0),f.maxEmitBox=new t(1,0,0),f.minSize=.3,f.maxSize=.3,f.color1=_,f.color2=_,f.colorDead=new i(0,0,0,0),f.minLifeTime=1,f.maxLifeTime=2,f.emitRate=20,f.gravity=new t(0,-9.8,0),f.direction1=g,f.direction2=g,f.minEmitPower=10,f.maxEmitPower=13,f.updateSpeed=.01,f.targetStopDuration=.2,f.disposeOnStop=!0,f.start()}o.setVerticesData(be.ColorKind,l)}}var Oi="_subTaskUi_cabac_1",Pi="_none_cabac_25";const Ci=new class{constructor(){this.subTask=null,this.showing=!1,I(this)}setSubTaskWithShowing(e,t){this.showing=e,this.subTask=t}},Li=te((e=>{const t=e.uiState,i=t.subTask;return ie.createElement(ie.Fragment,null,ie.createElement(ne,{className:`${Oi} ${t.showing?"":Pi}`,title:null==i?void 0:i.name},ie.createElement("div",{className:Oi}),ie.createElement(se,null,ie.createElement(me,{level:5},"任务类型"),ie.createElement(ye,null,(e=>{switch(e){case Rt.video:return ie.createElement(ie.Fragment,null,ie.createElement(Ne,{component:xi}),"  观看视频");case Rt.practice:return ie.createElement(ie.Fragment,null,ie.createElement(Ne,{component:Bi}),"  课后练习");case Rt.read:return ie.createElement(ie.Fragment,null,ie.createElement(Ne,{component:Ui}),"  阅读电子书籍");default:return"无"}})(null==i?void 0:i.type)),ie.createElement(me,{level:5},"任务描述"),ie.createElement(ye,null,null==i?void 0:i.description),ie.createElement(me,{level:5},"任务状态"),(e=>{switch(e){case bt.UnFinished:return ie.createElement(ye,{style:{color:"gray"}},"未完成");case bt.Finished:return ie.createElement(ie.Fragment,null,ie.createElement("span",{style:{color:"lightgreen"}},"已完成"),ie.createElement("br",null),"评分等级  : ",null==i?void 0:i.rate,"分 ",ie.createElement(Te,{value:null==i?void 0:i.rate,disabled:!0}));case bt.OnProgress:return ie.createElement(ye,{style:{color:"orange"}},"正在进行");default:return ie.createElement(ye,null,"未知")}})(null==i?void 0:i.status),(null==(s=t.subTask)?void 0:s.status)==bt.OnProgress?ie.createElement(ie.Fragment,null,ie.createElement(me,{level:5},"子任务进度"),ie.createElement(ye,null,ie.createElement(Se,{strokeColor:{"0%":"#f7797d","50%":"#FBD786","100%":"#C6FFDD"},percent:null==i?void 0:i.progress,status:"active",format:e=>`${null==e?void 0:e.toFixed(0)}%`}))):null)));var s})),Bi=()=>ie.createElement("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4151",id:"mx_n_1615018481175","data-spm-anchor-id":"a313x.7781069.0.i5",width:"30",height:"30"},ie.createElement("path",{d:"M680 260.352L450.112 658.56l-181.12-104.512 229.952-398.272z",fill:"#1890FF","p-id":"4152","data-spm-anchor-id":"a313x.7781069.0.i7",className:"selected"}),ie.createElement("path",{d:"M531.392 607.616l-38.784-22.4-42.432 73.408-47.04-27.072L632.96 233.216l47.04 27.136-43.264 74.944 38.784 22.4 54.464-94.336a22.4 22.4 0 0 0-8.192-30.592L501.952 105.792a22.592 22.592 0 0 0-30.656 8.192L219.072 551.04a21.952 21.952 0 0 0-2.752 9.856l-0.384-0.192 3.2 226.752 0.448 0.256a33.92 33.92 0 0 0 16.64 32.384 33.92 33.92 0 0 0 36.352-1.728l0.384 0.256 198.016-110.592-0.384-0.192a22.144 22.144 0 0 0 7.168-7.232l53.632-92.992z m33.984-413.44l48.192 27.84-229.888 398.336-48.128-27.776 229.824-398.4z m-66.432-38.336l47.04 27.2L316.16 581.376l-47.104-27.328 229.888-398.208z m-195.072 594.944l-41.664-24.192-0.448-124.928 149.76 86.528-107.648 62.592z",fill:"","p-id":"4153"}),ie.createElement("path",{d:"M585.28 514.112l-38.784-22.4 54.336-94.08 38.784 22.4z",fill:"","p-id":"4154"}),ie.createElement("path",{d:"M655.424 347.712m-22.4 0a22.4 22.4 0 1 0 44.8 0 22.4 22.4 0 1 0-44.8 0Z",fill:"","p-id":"4155"}),ie.createElement("path",{d:"M620.16 408.832m-22.4 0a22.4 22.4 0 1 0 44.8 0 22.4 22.4 0 1 0-44.8 0Z",fill:"","p-id":"4156"}),ie.createElement("path",{d:"M512.832 594.944m-22.4 0a22.4 22.4 0 1 0 44.8 0 22.4 22.4 0 1 0-44.8 0Z",fill:"","p-id":"4157"}),ie.createElement("path",{d:"M565.824 502.912m-22.4 0a22.4 22.4 0 1 0 44.8 0 22.4 22.4 0 1 0-44.8 0Z",fill:"","p-id":"4158"}),ie.createElement("path",{d:"M99.584 906.88m-22.4 0a22.4 22.4 0 1 0 44.8 0 22.4 22.4 0 1 0-44.8 0Z",fill:"","p-id":"4159"}),ie.createElement("path",{d:"M950.4 906.944c0 12.288-10.048 22.4-22.4 22.4H188.928a22.464 22.464 0 0 1-22.4-22.4v-0.064c0-12.288 10.112-22.4 22.4-22.4H928c12.288 0 22.4 10.112 22.4 22.464zM950.4 811.328c0 12.288-10.048 22.4-22.4 22.4H496.96a22.464 22.464 0 0 1-22.4-22.4v-0.064c0-12.288 10.112-22.4 22.4-22.4H928c12.288 0 22.4 10.048 22.4 22.464z",fill:"#1890FF","p-id":"4160","data-spm-anchor-id":"a313x.7781069.0.i6",className:"selected"})),xi=()=>ie.createElement("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5267",width:"30",height:"30"},ie.createElement("path",{d:"M644 574.8L471.2 461.7c-18.1-11.8-43.7-4.7-50.6 16.2-1.3 3.9-2 8-2 12.3v230.4c0 4.3 0.7 8.4 2 12.3 6.9 20.9 32.5 28 50.6 16.2L647.1 634c8.8-5.8 14.2-15.8 14.2-26.6 0-13.3-6.5-25.5-17.3-32.6zM633.3 904H596c-15.5 0-28 12.5-28 28s12.5 28 28 28h37.3c15.5 0 28-12.5 28-28s-12.5-28-28-28z",fill:"#1890FF","p-id":"5268"}),ie.createElement("path",{d:"M885.3 64H138.7C97.6 64 64 97.6 64 138.7v746.7c0 41.1 33.6 74.7 74.7 74.7h364c15.5 0 28-12.5 28-28s-12.5-28-28-28H157.3c-20.5 0-37.3-16.8-37.3-37.3v-560h784v560c0 20.5-16.8 37.3-37.3 37.3h-140c-15.5 0-28 12.5-28 28s12.5 28 28 28h158.7c41.1 0 74.7-33.6 74.7-74.7V138.7C960 97.6 926.4 64 885.3 64zM120 250.7v-93.3c0-20.5 16.8-37.3 37.3-37.3h27.9l75.4 130.7H120z m205.4 0L249.9 120h80l75.4 130.7h-79.9z m144.7 0L394.6 120h122L592 250.7H470.1z m186.6 0L581.3 120h117.4l75.4 130.7H656.7z m247.3 0h-65.3L763.3 120h103.4c20.5 0 37.3 16.8 37.3 37.3v93.4z",fill:"#1890FF","p-id":"5269"})),Ui=()=>ie.createElement("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6172",width:"30",height:"30"},ie.createElement("path",{d:"M863 942H500.3L309.7 822.6c-33.8-21.2-54.9-60.7-54.9-103V162.5c0-30.4 14.5-57.6 38.7-72.9 24.4-15.4 53.6-15.4 78-0.1L507 174.3h356c52.9 0 96 46.9 96 104.6v558.4c0 57.8-43.1 104.7-96 104.7z m-345.6-69.8H863c17.6 0 32-15.6 32-34.9V278.9c0-19.2-14.4-34.9-32-34.9H489.9l-150.3-94.1c-6.4-4-12-1.3-14.1 0-2.5 1.6-6.7 5.3-6.7 12.6v557.1c0 17.5 8.7 33.8 22.8 42.5l175.8 110.1z",fill:"#1890FF","p-id":"6173"}),ie.createElement("path",{d:"M508.8 942H161c-52.9 0-96-46.9-96-104.6V278.9c0-57.7 43.1-104.6 96-104.6h125.8v69.8H161c-17.6 0-32 15.6-32 34.9v558.4c0 19.2 14.4 34.9 32 34.9h347.8V942zM497.5 174.3h1v69.8h-1z",fill:"#1890FF","p-id":"6174"}),ie.createElement("path",{d:"M480 209.2h64v697.2h-64z",fill:"#1890FF","p-id":"6175"}));class Di{constructor(e,i){this._mat={},this._unfinishedPos=new t(0,0,0),this._targetPos=new t(0,0,0),this._finishedPos=new t(0,0,0),this._fireworkStartPos=[],this._fireworkHeight=0,this._stairCase=[],this._currentIndex=0,this._fireworks=[],this._fireworkStart=!1,this.flagSuccessCallBack=(e,t,i,s,o,a,n)=>{e[0].parent=this._flagNode,this._flagNode.scaling.set(2,2,2),this._flagNode.rotation.y=Math.PI/2},this.rotateCount=0,this.arrowSuccessCallBack=(e,t,i,s,o,a,n)=>{e[0].parent=this._arrowNode,this._arrowNode.position.copyFrom(this._unfinishedPos),this._scene.registerBeforeRender((()=>{this._arrowNode.position.x=this._unfinishedPos.x,this._arrowNode.position.y=.3*Math.sin(this.rotateCount)+this._unfinishedPos.y,this.rotateCount+=.01,this._arrowNode.rotation.y+=.015}))},this._currentTask=i,this._engine=new ee(e,!0,{stencil:!0}),this._scene=new V(this._engine),this._flagNode=new o("flag",this._scene),this._arrowNode=new o("arrow",this._scene),this._highLightLayer=new x("highLightLayer",this._scene),this._scene.autoClear=!1,this._clickSound=new g("clickSound","sound/collegeBuildingClick.mp3",this._scene,(()=>{}),{volume:.3}),e.addEventListener("resize",(()=>{this._engine.resize()})),this.setUpCamera(),this.setUpMaterial(),this.setUpStaircase(),this.setUpFirework(),this._engine.runRenderLoop((()=>{this._scene.render()}))}setUpFirework(){this._fireworkStartPos.forEach((e=>{this._fireworks.push(new Ii(this._scene,e,this._fireworkHeight))})),this._scene.registerBeforeRender((()=>{this._fireworkStart&&this._fireworks.forEach((e=>{e.launchFireWork()}))}))}setUpMaterial(){const e=new Me("finished",this._scene);e.topColor=E.FromHexString("#AAFFA9"),e.bottomColor=E.FromHexString("#11FFBD"),e.offset=.5,e.smoothness=1,this._mat.finished=e;const t=new Me("unfinished",this._scene);t.topColor=E.FromHexString("#bdc3c7"),t.bottomColor=E.FromHexString("#a7a8c2"),t.offset=.5,this._mat.unfinished=t;const i=new Me("onProgress",this._scene);i.topColor=E.FromHexString("#F2994A"),i.bottomColor=E.FromHexString("#F2C94C"),i.offset=.5,this._mat.onprogress=i;const s=new Me("ground",this._scene);s.topColor=E.FromHexString("#89beea"),s.bottomColor=E.FromHexString("#89beea"),this._mat.ground=s}setUpCamera(){let i=new t(this._currentTask.subTask.length/2+1,this._currentTask.subTask.length/2+1,-1),s=new e("camera",3.647,1,10,i,this._scene);s.mode=Re.ORTHOGRAPHIC_CAMERA;var o=this._scene.getEngine().getRenderingCanvasClientRect().height/this._scene.getEngine().getRenderingCanvasClientRect().width;s.orthoLeft=-8.5,s.orthoRight=8.5,s.orthoBottom=s.orthoLeft*o,s.orthoTop=s.orthoRight*o,s.attachControl(),this._scene.createDefaultLight()}setUpStaircase(){let e=0,i=0;for(let o=0;o<this._currentTask.subTask.length;o++){const s=this._currentTask.subTask[o],a=L.CreateBox(`stairCase${o}`,{width:1,height:1,depth:6});this._stairCase.push(a),this.setGlow(a,s),a.position.set(e,i,0),s.status==bt.UnFinished?a.material=this._mat.unfinished:s.status==bt.Finished?a.material=this._mat.finished:s.status==bt.OnProgress&&(this._unfinishedPos=new t(e,i+1,0),this._targetPos=new t(e,i+1,0),a.material=this._mat.onprogress,this._currentIndex=o),i+=1,e+=1}this._finishedPos=new t(e,i+1,0);const s=L.CreateBox("ground",{width:4,height:1,depth:10});s.position.set(e+1.5,i,0),s.material=this._mat.ground,this._flagNode.position.set(++e,i,0),a.ImportMesh("","model/flag.glb",void 0,this._scene,this.flagSuccessCallBack),a.ImportMesh("","model/arrow.glb",void 0,this._scene,this.arrowSuccessCallBack),this._scene.registerBeforeRender((()=>{this._unfinishedPos=t.Lerp(this._unfinishedPos,this._targetPos,.03)}));const n=new o("firework-1",this._scene);n.position.set(e,0,8),this._fireworkStartPos.push(n),this._fireworkHeight=i+2;const r=new o("firework-2",this._scene);r.position.set(e,0,-8),this._fireworkStartPos.push(r)}moveToNext(){this._targetPos.x+=1,this._targetPos.y+=1,this.updateMat(),this.checkFinished()}setGlow(e,t){const i=Ci;e.actionManager=new v(this._scene),e.actionManager.registerAction(new T(v.OnPointerOverTrigger,(s=>{this._clickSound.play(),this._highLightLayer.addMesh(e,E.White()),i.setSubTaskWithShowing(!0,t)}))),e.actionManager.registerAction(new T(v.OnPointerOutTrigger,(s=>{this._highLightLayer.removeMesh(e),i.setSubTaskWithShowing(!1,t)})))}checkFinished(){this._targetPos.equals(this._finishedPos)&&(this._fireworkStart=!0)}updateMat(){if(this._stairCase[this._currentIndex].material=this._mat.finished,this._currentIndex++,this._currentIndex<this._stairCase.length){this._stairCase[this._currentIndex].material=this._mat.onprogress}}dispose(){this._engine.dispose()}}var Fi="_taskState_84v0i_1",Hi="_stairCase_84v0i_13",Vi="_misc_84v0i_27",Gi="_playerUi_84v0i_39",$i="_taskTab_84v0i_57",Wi="_content_84v0i_81",zi="_imageLeft_84v0i_103",Yi="_bg_84v0i_117",ji="_unSkew_84v0i_147",Ji="_none_84v0i_155";var Ki="_clock_1gdgc_5",qi="_miscTab_1gdgc_15",Xi="_version_1gdgc_25";const Zi=()=>{const[e,t]=ie.useState(new Date);return ie.useEffect((()=>{const e=setInterval((()=>{t(new Date)}),1e3);return()=>clearInterval(e)})),ie.createElement("div",{className:qi},ie.createElement("h1",{className:Xi},"Ver 1.0.0"),ie.createElement("h1",{className:Ki},"系统时间: ",e.toLocaleTimeString("chinese",{hour12:!1})))},Qi=te((e=>{const t=e.uiState,i=Ci,s=ie.useRef(null);ie.useEffect((()=>{if(t.isShowing&&t.currentTask&&t.currentTask.uuid>0){console.log("生成楼梯");let e=new Di(s.current,t.currentTask);return Dt.setStairCase(e),()=>{e.dispose()}}}),[t.isShowing,t.currentTask]);return ie.createElement(ie.Fragment,null,ie.createElement("div",{className:Gi},(o=t.isShowing,a=t.currentTask,console.log("进入content"),o?ie.createElement(ie.Fragment,null,ie.createElement("div",{className:Fi},ie.createElement(es,{task:a})),ie.createElement("canvas",{className:Hi,ref:s}),ie.createElement("div",{className:Vi},ie.createElement(Zi,null))):ie.createElement(ie.Fragment,null))),ie.createElement(Li,{uiState:i}),ie.createElement("div",{className:`${Yi} ${t.isShowingDialog?"":Ji}`},ie.createElement("div",{className:`${Wi} ${ji}`},ie.createElement("img",{src:t.dialog.avatarURL,alt:"",className:zi}),ie.createElement("br",null),ie.createElement("br",null),ie.createElement("h1",{style:{textAlign:"center"}},t.dialog.info))));var o,a})),es=te((e=>{const t=e.task;let i=t.subTask.filter((e=>e.status==bt.Finished));console.log(`${i.length} - ${t.subTask.length}`);let s=i.length/t.subTask.length*100,o=0;i.forEach((e=>{o+=e.rate}));let a=5*t.subTask.length;return e.task.uuid>0?ie.createElement(ne,{className:$i,title:"正在进行中"},ie.createElement(se,null,ie.createElement(me,{level:5},"任务名称"),ie.createElement(ye,null,t.name),ie.createElement(me,{level:5},"任务介绍"),ie.createElement(ye,null,t.description),ie.createElement(me,{level:5},"任务目的"),ie.createElement(ye,null,t.goal),ie.createElement(me,{level:5},"任务进度"),ie.createElement(ye,null,ie.createElement(Se,{strokeColor:{"0%":"#f7797d","50%":"#FBD786","100%":"#C6FFDD"},percent:s,status:"active",format:e=>`${null==e?void 0:e.toFixed(0)}%`})),ie.createElement(me,{level:5},"任务总评分"),ie.createElement(ye,null,"当前获得分数: ",o," 分 / 总分: ",a," 分"))):ie.createElement(ne,{className:$i,title:"当前未接到任务"})}));var ts="_closeButtonArea_1ru0e_1",is="_none_1ru0e_17",ss="_closeButton_1ru0e_1",os="_videoPlayerArea_1ru0e_33",as="_videoArea_1ru0e_49",ns="_videoNameArea_1ru0e_65",rs="_videoName_1ru0e_65",ls="_shelfArea_1ru0e_87",hs="_shelfCloseButton_1ru0e_105";const cs=te((e=>{var t,i;const s=e.uiState,o=Dt;return ie.createElement(ie.Fragment,null,ie.createElement("div",{className:`${as} ${s.videoShowing?"":is}`},ie.createElement("div",{className:`${ts}`},ie.createElement(ve,{title:"合上书籍"},ie.createElement(de,{type:"primary",icon:ie.createElement(Ie,{style:{fontSize:"40px"},onClick:()=>{var e;s.setVideoShowing(!1),null==(e=s.currentBook)||e.moveToOriginStepOne(),s.setShelfShowing(!0)}}),className:ss}))),ie.createElement("div",{className:os},ie.createElement(Oe,{playing:s.videoShowing,width:"100%",height:"100%",controls:!0,url:null==(t=s.currentBookDetail)?void 0:t.videoURL,onProgress:e=>{s.currentBookDetail&&o.updateCurrentSubTaskProgress(Rt.video,s.currentBookDetail.uuid,100*e.played)},loop:!1})),ie.createElement("div",{className:ns},ie.createElement("h1",{className:rs},null==(i=s.currentBookDetail)?void 0:i.videoName))),ie.createElement("div",{className:`${ls} ${s.shelfShowing?"":is}`},ie.createElement(ve,{title:"关闭书架"},ie.createElement(de,{type:"primary",icon:ie.createElement(Ie,{style:{fontSize:"50px"},onClick:()=>{var e;s.setShelfShowing(!1),null==(e=s.web3DStudio)||e.setBookShelfShow(!1)}}),className:hs}))))}));var us="_eBookReaderArea_192qe_1",ms="_none_192qe_21",ds="_eBookReaderClose_192qe_29",_s="_closeButton_192qe_43",ps="_practiceArea_192qe_53",gs="_practiceSider_192qe_71",fs="_practiceMainArea_192qe_85",As="_practiceHeader_192qe_93",ws="_centerButton_192qe_105",vs="_centerText_192qe_113",Ts="_practiceContentArea_192qe_121",ks="_taskCard_192qe_129",ys="_practiceTableCloseArea_192qe_147",Es="_practiceTableCloseButton_192qe_161",bs="_eBookReaderLoaderProgressArea_192qe_169",Ns="_eBookReaderLoaderProgress_192qe_169";const Ss=e=>{const t=e.task,i=t.choice,s=Ut;return ie.createElement(ne,{className:ks,title:`${e.index+1}.${t.name}`,extra:ie.createElement("h1",{style:{color:"#40A9FF"}},t.score,"分")},ie.createElement(Be.Group,{name:"radiogroup",style:{width:"100%"},onChange:t=>{s.practiceAnswer[e.index].answer=t.target.value}},ie.createElement(ge,null,(()=>{const e=24/i.length;return i.map(((t,i)=>ie.createElement(fe,{span:e},ie.createElement(Be,{value:i},t))))})())))},Ms=e=>{const t=e.task,i=Ut;return ie.createElement(ne,{className:ks,title:`${e.index+1}.${t.name}`,extra:ie.createElement("h1",{style:{color:"#40A9FF"}},t.score,"分")},ie.createElement(xe,{rows:4,placeholder:"在这里粘贴代码",onChange:t=>{i.practiceAnswer[e.index].answer=t.target.innerHTML}}))},Rs=e=>{const t=e.task,i=Ut;return ie.createElement(ne,{className:ks,title:`${e.index+1}.${t.name}`,extra:ie.createElement("h1",{style:{color:"#40A9FF"}},t.score,"分")},ie.createElement(xe,{rows:4,placeholder:"在这里简要回答",onChange:t=>{i.practiceAnswer[e.index].answer=t.target.innerHTML}}))},Is=e=>{const t=e.task,i=Ut;return ie.createElement(ne,{className:ks,title:`${e.index+1}.${t.name}`,extra:ie.createElement("h1",{style:{color:"#40A9FF"}},t.score,"分")},ie.createElement(xe,{rows:4,placeholder:"在这里简要回答",onChange:t=>{i.practiceAnswer[e.index].answer=t.target.innerHTML}}))},Os=te((e=>{const t=e.uiState,i=t.currentPracticeDetail,[s,o]=ie.useState(!1);return ie.createElement(ie.Fragment,null,ie.createElement("div",{className:`${ys} ${t.practiceTableShowing?"":ms}`},ie.createElement(ve,{title:"关闭练习台"},ie.createElement(de,{type:"primary",icon:ie.createElement(Ie,{style:{fontSize:"50px"},onClick:()=>{var e;t.setPracticeTableShowing(!1),null==(e=t.web3DStudio)||e.setPracticeTableShow(!1)}}),className:Es}))),ie.createElement("div",{className:`${ds} ${t.eBookReaderShowing?"":ms}`},ie.createElement(ve,{title:"关闭电子书"},ie.createElement(de,{type:"primary",icon:ie.createElement(Ie,{style:{fontSize:"40px"},onClick:()=>{var e;t.setEBookReaderShowing(!1),null==(e=t.currentEBook)||e.moveToOriginStepOne()}}),className:_s}))),ie.createElement(Ps,{eBookReaderShowing:t.eBookReaderShowing,eBookUUID:t.currentEBookDetail.uuid,eBookFile:t.currentEBookDetail?t.currentEBookDetail.bookURL:"pdf/Java.pdf"}),ie.createElement("div",{className:`${ps} ${t.practiceShowing?"":ms}`},ie.createElement(re,{style:{height:"100%"}},ie.createElement(le,{className:gs,theme:"light"},ie.createElement(ge,{align:"middle",justify:"center",style:{height:"64px"}},ie.createElement(fe,{span:2}),ie.createElement(fe,{span:6},ie.createElement("div",{className:ws},ie.createElement(Pe,{style:{fontSize:"40px"}}))),ie.createElement(fe,{span:12},ie.createElement("h1",{className:vs},"练习中心")),ie.createElement(fe,{span:4}))),ie.createElement(re,{className:fs},ie.createElement(ue,{className:As},ie.createElement(ge,{justify:"center",align:"middle"},ie.createElement(fe,{span:20},ie.createElement("h1",{className:vs},null==i?void 0:i.name)),ie.createElement(fe,{span:2},ie.createElement(de,{type:"primary",icon:ie.createElement(Ce,null),size:"large",className:ws,onClick:()=>{o(!0)}},"提交")),ie.createElement(fe,{span:2},ie.createElement(de,{type:"default",danger:!0,icon:ie.createElement(_e,null),size:"large",className:ws,onClick:()=>{t.setPracticeShowing(!1)}})))),ie.createElement(pe,{style:{padding:"24px"},className:Ts},i.subTasks.map(((e,t)=>{switch(e.type){case Lt.choice:return ie.createElement(Ss,{task:e,index:t});case Lt.code:return ie.createElement(Ms,{task:e,index:t});case Lt.fillInBlank:return ie.createElement(Rs,{task:e,index:t});case Lt.questions:return ie.createElement(Is,{task:e,index:t})}})))))),ie.createElement(ke,{title:"确认提交练习",visible:s,onOk:()=>{o(!1),t.submit()},onCancel:()=>{o(!1)},okText:"确认",cancelText:"取消"},(()=>{const e=t.unFinishedPracticeCount;return console.log(e),0!=e?ie.createElement("p",null,"您还有",e,"道题目未答,是否提交?"):ie.createElement("p",null,"你已完成所有题目,可以提交")})()))})),Ps=e=>ie.createElement("div",{className:`${us} ${e.eBookReaderShowing?"":ms}`},ie.createElement(Le.Worker,{workerUrl:"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js"},ie.createElement(Le.Viewer,{fileUrl:e.eBookFile,renderLoader:e=>ie.createElement("div",{className:bs},ie.createElement(Se,{strokeColor:{"0%":"#108ee9","100%":"#87d068"},status:"active",percent:e,className:Ns,format:e=>`加载中 ${null==e?void 0:e.toFixed(0)}%`})),renderError:e=>ie.createElement(ie.Fragment,null,ie.createElement("h1",null,"错误"),ie.createElement("h2",null,e.name),ie.createElement("p",null,e.message)),onPageChange:t=>{const i=(t.currentPage+1)/t.doc.numPages*100;Dt.updateCurrentSubTaskProgress(Rt.read,e.eBookUUID,i)}})));var Cs="_notePadSider_qocel_3",Ls="_notePadArea_qocel_19",Bs="_notePadEditor_qocel_29",xs="_dragArea_qocel_41",Us="_newNote_qocel_73",Ds="_header_qocel_97",Fs="_centerButton_qocel_107",Hs="_editTitle_qocel_117",Vs="_openButtonArea_qocel_125",Gs="_openButton_qocel_125",$s="_none_qocel_159";const Ws=new Ue,zs=$e("notePadData",[{key:"0",title:"笔记1",content:"# 内容1"},{key:"1",title:"笔记2",content:"# 内容2"},{key:"2",title:"笔记3",content:"# 内容3"}]),Ys=e=>{const[t,i]=zs(),[s,o]=ie.useState(!1);let a="";t.length>=1&&(a=t[0].key);const[n,r]=ie.useState(a);ie.useState(!0);const[l,h]=ie.useState({x:80,y:400}),[c,u]=ie.useState({width:"200px",height:"300px"}),m=e=>{i((i=>(t.find((e=>e.key==n)).content=e.text,i)))},d=()=>{if(1==t.length)return;let e=[...t],s=e.find((e=>e.key==n)),o=e.indexOf(s,0);o>=0&&(r(o-1>=0?e[o-1].key:e[e.length-1].key),e.splice(o,1),i(e))};return ie.createElement(ie.Fragment,null,ie.createElement("div",{className:Vs},ie.createElement(ve,{title:s?"关闭笔记本":"打开笔记本"},ie.createElement(de,{icon:ie.createElement(De,{style:{fontSize:"30px"}}),shape:"circle",onClick:()=>o(!s),className:Gs}))),ie.createElement(Fe,{size:{width:c.width,height:c.height},className:` ${s?"":$s}`,position:{x:l.x,y:l.y},onDragStop:(e,t)=>h({x:t.x,y:t.y}),onResizeStop:(e,t,i,s,o)=>{u({width:i.style.width,height:i.style.height})},minWidth:"40%",minHeight:"40%",maxWidth:"80%",maxHeight:"80%",cancel:".no-drag",enableResizing:{bottom:!0,right:!0,bottomRight:!0}},ie.createElement("div",{className:xs}),ie.createElement("div",{className:`${Bs} no-drag`},ie.createElement(re,{style:{height:"100%"}},ie.createElement(le,{className:`${Cs} `,theme:"light"},ie.createElement("div",{className:Us},ie.createElement(de,{type:"primary",shape:"round",icon:ie.createElement(He,null),size:"large",onClick:()=>{const e=Number(t[t.length-1].key)+1;let s={title:`笔记-${e}`,content:"# 标题",key:e.toString()};t.push(s),r(s.key),i(t)}},"新建笔记")),ie.createElement(ce,{theme:"light",mode:"inline",selectedKeys:[n],onClick:e=>r(e.key.toString())},t.map(((e,t)=>ie.createElement(ce.Item,{key:e.key},e.title))))),ie.createElement(re,{className:Ls},(e=>{let s=t.find((t=>t.key==e));const a=ie.createElement(We,{value:s.content,style:{height:"100%"},renderHTML:e=>Ws.render(e),onChange:m});return ie.createElement(ie.Fragment,null,ie.createElement(ue,{className:Ds},ie.createElement(ge,{justify:"center",align:"middle"},ie.createElement(fe,{span:18,className:"no-drag"},ie.createElement(Ve,{value:s.title,className:Hs,onChange:e=>{return s=e.target.value,void i((e=>(t.find((e=>e.key==n)).title=s,e)));var s}})),ie.createElement(fe,{span:4},ie.createElement(de,{type:"primary",shape:"round",danger:!0,icon:ie.createElement(Ge,null),size:"large",disabled:1==t.length,className:Fs,onClick:d},"删除")),ie.createElement(fe,{span:2},ie.createElement(de,{type:"default",icon:ie.createElement(_e,null),size:"large",className:Fs,onClick:()=>o(!1)})))),ie.createElement(pe,{style:{padding:"24px"},className:"no-drag"}," ",a))})(n))))))},js=te((e=>{const t=e.uiState;return ie.createElement("div",{className:`${Ai} ${t.isShowingDialog?"":vi}`},ie.createElement("div",{className:`${gi} ${wi}`},ie.createElement("img",{src:t.dialog.avatarURL,alt:"",className:fi}),ie.createElement("h2",{className:pi},"职务：",t.dialog.position," 岗位：",t.dialog.title),ie.createElement("h1",{style:{textAlign:"center"}},t.dialog.info)))}));var Js="_none_1ji69_1",Ks="_selectFloor_1ji69_9",qs="_selectFloorDiv_1ji69_33",Xs="_selectFloorButton_1ji69_45",Zs="_visitUiArea_1ji69_61",Qs="_visitUiShowing_1ji69_121",eo="_everyFloorUi_1ji69_131",to="_everyFloorUiShowing_1ji69_161",io="_singleFloor_1ji69_167",so="_singleFloorTitle_1ji69_189",oo="_singleFloorStudios_1ji69_257",ao="_singleFloorStudio_1ji69_257",no="_studio_1ji69_285",ro="_visitStudioUiArea_1ji69_309",lo="_visitStudioUiShowing_1ji69_371";const ho=e=>{const t=e.floor,i=mt;return ie.createElement("div",{className:io},ie.createElement("div",{className:so},ie.createElement("h2",null,t.floorNumber,"楼"),ie.createElement("div",null,ie.createElement(ve,{title:`前往楼层${t.floorNumber}`,placement:"right"},ie.createElement(ze,{style:{fontSize:"2.0em"},onClick:()=>i.goToFloor(t.floorNumber)})))),ie.createElement("div",{className:oo},t.studios.map((e=>ie.createElement(ie.Fragment,null,ie.createElement("div",{className:ao},ie.createElement("div",{className:no},ie.createElement(Ye,{src:e.logoURL,size:"large"}),ie.createElement("h4",null," ",e.name))))))))},co=te((e=>{const t=e.uiState;return ie.createElement(ie.Fragment,null,ie.createElement("div",{className:`${Ks}  ${t.uiShowing?"":Js}`},(()=>{const e=t.floorTotalNumber;let i=[];i.push(ie.createElement("div",{className:qs},ie.createElement(ve,{title:"查看所有楼层",placement:"left"},ie.createElement(de,{shape:"circle",className:Xs,onClick:()=>t.goToFloor(-1)},"All"))));for(let s=e;s>0;s--)i.push(ie.createElement("div",{className:qs},ie.createElement(ve,{title:`前往楼层${s}`,placement:"left"},ie.createElement(de,{shape:"circle",onClick:()=>t.goToFloor(s),className:Xs},s))));return i})()),ie.createElement("div",{className:`${Zs} ${t.visitUiShowing?Qs:""}`,onMouseEnter:()=>{t.onMouseEnterVisitButton()},onMouseLeave:()=>{t.onMouseLeaveVisitButton()},onClick:()=>{t.goToVisit()}},"游览该层楼"),ie.createElement("div",{className:`${eo} ${t.everyFloorUiShowing?to:""}`},(()=>{var e;const i=null==(e=t.collegeFloors)?void 0:e.floors;return null==i?void 0:i.slice().reverse().map((e=>ie.createElement(ie.Fragment,null,ie.createElement(ho,{floor:e}))))})()),ie.createElement("div",{className:`${ro} ${t.visitStudioUiShowing?lo:""}`,onClick:()=>{t.goToStudio()}},"进入工作室"))})),uo=()=>{const e=ie.useRef(null);ie.useEffect((()=>{new hi(e.current)}));const t=lt,i=Qt,s=Pt,o=Dt,a=Et,n=Ut,r=ti,l=mt;return ie.createElement(ie.Fragment,null,ie.createElement("canvas",{id:"renderCanvas",ref:e}),ie.createElement(_i,{uiState:t}),ie.createElement(Ti,{receptionistUiState:i}),ie.createElement(Ri,{taskUiState:s}),ie.createElement(Qi,{uiState:o}),ie.createElement(cs,{uiState:a}),ie.createElement(Os,{uiState:n}),ie.createElement(Ys,null),ie.createElement(js,{uiState:r}),ie.createElement(co,{uiState:l}))};function mo(){return ie.createElement(je,null,ie.createElement(Je,null,ie.createElement(Ke,{path:"/computer"},ie.createElement("h1",null,"Computer")),ie.createElement(Ke,{path:"/"},ie.createElement(uo,null))))}qe.render(ie.createElement(ie.StrictMode,null,ie.createElement(mo,null)),document.getElementById("root"));
